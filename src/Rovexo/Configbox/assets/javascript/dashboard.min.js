define(["cbj","configbox/server"],function(a,d){var c={initDashboard:function(){c.adaptNewsBoxHeight();c.addDashboardInfo();c.addLicenseInfo();a(document).on("click",".view-admindashboard .dashboard-toggle-wrapper .toggle-handle",function(){a(this).closest(".dashboard-toggle-wrapper").find(".toggle-content").toggle();a(this).toggleClass("opened")});a(document).on("click",".view-admindashboard .trigger-remove-file-structure-warning",function(){d.makeRequest("admindashboard","removeFileStructureWarning",
[]);a(this).closest(".issue-item").remove()})},adaptNewsBoxHeight:function(){var b=a(".view-admindashboard").height();a(".view-admindashboard .news").height(b)},addDashboardInfo:function(){var b={platform:d.config.platformName,lang:d.config.languageCode,version:a(".kenedo-view.view-admindashboard").data("configbox-version")};a.ajax({url:a(".kenedo-view.view-admindashboard").data("endpoint-url-dashboard-info"),dataType:"jsonp",crossDomain:!0,data:b,success:function(a){c.injectDataDashboardInfo(a)},
error:function(){a(".view-admindashboard .news").html("Cannot load news at this time.")}})},injectDataDashboardInfo:function(b){a(".view-admindashboard .news .news-target").html(b.news);a(".view-admindashboard .news").css("visibility","visible");a(".checking-for-update").hide();b.softwareUpdate.url&&a(".software-update-link").attr("href",b.softwareUpdate.url);b.softwareUpdate.patchLevel&&(a(".latest-version-patchlevel").text(b.softwareUpdate.patchLevel),a(".patchlevel-update-available").show());b.softwareUpdate.major&&
(a(".latest-version-major").text(b.softwareUpdate.major),a(".major-update-available").show());b.softwareUpdate.major||b.softwareUpdate.patchLevel||a(".no-update-available").show()},addLicenseInfo:function(){var b=a(".kenedo-view.view-admindashboard").data("license-key");b&&(b={license_key:b,lang:d.config.languageCode},a.ajax({url:a(".kenedo-view.view-admindashboard").data("endpoint-url-license-info"),dataType:"jsonp",crossDomain:!0,data:b,success:function(b){!0===b.success?a(".wrapper-license-data").html(b.html):
a(".wrapper-license-data").html(b.errors.join("<br />"))},error:function(){a(".wrapper-license-data").html("an error occurred loading your license data.")}}))}};return c});
