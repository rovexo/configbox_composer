var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.findInternal=function(a,e,g){a instanceof String&&(a=String(a));for(var f=a.length,b=0;b<f;b++){var c=a[b];if(e.call(g,c,b,a))return{i:b,v:c}}return{i:-1,v:void 0}};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.SIMPLE_FROUND_POLYFILL=!1;$jscomp.ISOLATE_POLYFILLS=!1;$jscomp.FORCE_POLYFILL_PROMISE=!1;$jscomp.FORCE_POLYFILL_PROMISE_WHEN_NO_UNHANDLED_REJECTION=!1;
$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(a,e,g){if(a==Array.prototype||a==Object.prototype)return a;a[e]=g.value;return a};$jscomp.getGlobal=function(a){a=["object"==typeof globalThis&&globalThis,a,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof global&&global];for(var e=0;e<a.length;++e){var g=a[e];if(g&&g.Math==Math)return g}throw Error("Cannot find global object");};$jscomp.global=$jscomp.getGlobal(this);
$jscomp.IS_SYMBOL_NATIVE="function"===typeof Symbol&&"symbol"===typeof Symbol("x");$jscomp.TRUST_ES6_POLYFILLS=!$jscomp.ISOLATE_POLYFILLS||$jscomp.IS_SYMBOL_NATIVE;$jscomp.polyfills={};$jscomp.propertyToPolyfillSymbol={};$jscomp.POLYFILL_PREFIX="$jscp$";var $jscomp$lookupPolyfilledValue=function(a,e){var g=$jscomp.propertyToPolyfillSymbol[e];if(null==g)return a[e];g=a[g];return void 0!==g?g:a[e]};
$jscomp.polyfill=function(a,e,g,f){e&&($jscomp.ISOLATE_POLYFILLS?$jscomp.polyfillIsolated(a,e,g,f):$jscomp.polyfillUnisolated(a,e,g,f))};$jscomp.polyfillUnisolated=function(a,e,g,f){g=$jscomp.global;a=a.split(".");for(f=0;f<a.length-1;f++){var b=a[f];if(!(b in g))return;g=g[b]}a=a[a.length-1];f=g[a];e=e(f);e!=f&&null!=e&&$jscomp.defineProperty(g,a,{configurable:!0,writable:!0,value:e})};
$jscomp.polyfillIsolated=function(a,e,g,f){var b=a.split(".");a=1===b.length;f=b[0];f=!a&&f in $jscomp.polyfills?$jscomp.polyfills:$jscomp.global;for(var c=0;c<b.length-1;c++){var d=b[c];if(!(d in f))return;f=f[d]}b=b[b.length-1];g=$jscomp.IS_SYMBOL_NATIVE&&"es6"===g?f[b]:null;e=e(g);null!=e&&(a?$jscomp.defineProperty($jscomp.polyfills,b,{configurable:!0,writable:!0,value:e}):e!==g&&(void 0===$jscomp.propertyToPolyfillSymbol[b]&&($jscomp.propertyToPolyfillSymbol[b]=$jscomp.IS_SYMBOL_NATIVE?$jscomp.global.Symbol(b):
$jscomp.POLYFILL_PREFIX+b),$jscomp.defineProperty(f,$jscomp.propertyToPolyfillSymbol[b],{configurable:!0,writable:!0,value:e})))};$jscomp.polyfill("Array.prototype.find",function(a){return a?a:function(e,g){return $jscomp.findInternal(this,e,g).v}},"es6","es3");
define(["cbj","kenedo","configbox/server","cbj.ui","cbj.bootstrap"],function(a,e,g){var f={initHtmlEditors:function(b){0!==b.find(".kenedo-html-editor.not-initialized").length&&cbrequire(["tinyMCE","configbox/server"],function(c,d){try{b.find(".kenedo-html-editor.not-initialized").each(function(){var k=a(this),h=a(this).get(0);k.removeClass("not-initialized");c.init({convert_urls:!1,document_base_url:d.config.urlBase,documentBaseURL:d.config.urlBase,baseURL:d.config.urlTinyMceBase,suffix:!0===d.config.useMinifiedJs?
".min":"",target:h,plugins:["advlist autolink link image lists charmap print preview hr anchor pagebreak spellchecker","searchreplace wordcount visualblocks visualchars code fullscreen insertdatetime nonbreaking","save table directionality emoticons template paste"],toolbar:"insertfile undo redo | styleselect | bold italic | alignleft aligncenter alignright alignjustify | bullist numlist outdent indent | link image | print preview media fullpage | forecolor backcolor emoticons",template_external_list_url:"js/template_list.js",
external_link_list_url:"js/link_list.js",external_image_list_url:"js/image_list.js",media_external_list_url:"js/media_list.js",style_formats:[{title:"Headers",items:[{title:"Header 1",format:"h1"},{title:"Header 2",format:"h2"},{title:"Header 3",format:"h3"},{title:"Header 4",format:"h4"},{title:"Header 5",format:"h5"},{title:"Header 6",format:"h6"}]},{title:"Inline",items:[{title:"Bold",icon:"bold",format:"bold"},{title:"Italic",icon:"italic",format:"italic"},{title:"Underline",icon:"underline",
format:"underline"},{title:"Strikethrough",icon:"strikethrough",format:"strikethrough"},{title:"Superscript",icon:"superscript",format:"superscript"},{title:"Subscript",icon:"subscript",format:"subscript"},{title:"Code",icon:"code",format:"code"}]},{title:"Blocks",items:[{title:"Paragraph",format:"p"},{title:"Blockquote",format:"blockquote"},{title:"Div",format:"div"},{title:"Pre",format:"pre"}]},{title:"Alignment",items:[{title:"Left",icon:"alignleft",format:"alignleft"},{title:"Center",icon:"aligncenter",
format:"aligncenter"},{title:"Right",icon:"alignright",format:"alignright"},{title:"Justify",icon:"alignjustify",format:"alignjustify"}]},{title:"Others",items:[{title:"Custom 1",selector:"p",classes:"custom-1"},{title:"Custom 2",selector:"p",classes:"custom-2"},{title:"Custom 3",selector:"p",classes:"custom-3"},{title:"Custom 4",selector:"p",classes:"custom-4"}]}]})})}catch(k){console.log("Init of TinyMCE failed. Error message was "+k)}})},initKenedoForm:function(b){a(b).find(".kenedo-details-form").each(function(){var c=
a(this).closest(".kenedo-details-form").data("record");e.setPropertyVisibility(null,c,a(this));a(this).on("kenedoFormDataChanged",e.setPropertyVisibility)})},initDatePickers:function(b){a(b).find(".datepicker").datepicker({dateFormat:"yy-mm-dd"});a(b).find(".kenedo-datepicker").each(function(){var c=a(this).closest(".kenedo-property").find(".form-control"),d=c.val();if(""===d||"0000-00-00"===d||"0000-00-00 00:00:00"===d)d=null;c={dateFormat:"yy-mm-dd",altFormat:"yy-mm-dd",altField:c};a(this).datepicker(c);
a(this).datepicker("setDate",d)})},initSortables:function(b){a(b).find(".sortable-listing tbody").sortable({handle:".sort-handle",items:"tr",axis:"y",scroll:!1,helper:function(c,d){d.children().each(function(){a(this).width(a(this).width())});return d},start:function(){var c=a(this).closest(".kenedo-listing-form");0!=e.getListParameter(c,"limit")&&((c=a(this).find(".sort-handle:first").data("unset-pagination-text"))?alert(c):alert("Please set items per page to all first"))},update:function(){var c=
a(this).closest(".kenedo-listing-form"),d=e.getListParameter(c,"listing_order_dir"),k={};var h="asc"===d.toLowerCase()?10:10*c.find(".item-row").length;c.find(".item-row").each(function(){var p=a(this).data("item-id");k[p]=h;h="asc"===d.toLowerCase()?h+10:h-10});var l=e.getListParameter(c,"controller"),m=JSON.stringify(k);f.sortingTimeout&&window.clearTimeout(f.sortingTimeout);f.sortingTimeout=window.setTimeout(function(){g.makeRequest(l,"storeOrdering",{updates:m})},500)}})},sortingTimeout:null,
initRulePasteButtonVisibility:function(b){this.hasClipboardRule()?b.find(".rule-wrapper .trigger-paste-rule").show():b.find(".rule-wrapper .trigger-paste-rule").hide()},hasClipboardRule:function(){return null!==this.getClipboardRule()},setClipboardRule:function(b){window.sessionStorage.setItem("clipboardRule",JSON.stringify(b))},getClipboardRule:function(){var b=window.sessionStorage.getItem("clipboardRule");return null===b?null:JSON.parse(b)},initChosenDropdowns:function(b){0<a(b).find("select.listing-filter, select.join-select, .property-type-dropdown select, select.make-me-chosen, select.chosen-dropdown").length&&
cbrequire(["cbj.chosen"],function(){a(b).find("select.listing-filter, select.join-select, .property-type-dropdown select, select.make-me-chosen, select.chosen-dropdown").chosen({disable_search_threshold:10,search_contains:!0,inherit_select_classes:!0,width:"100%"});a(b).find(".chosen-container:hidden").each(function(){a(this).is(".join-select")?a(this).css("width","100%"):a(this).closest(".kenedo-properties").length?a(this).css("width","100%"):a(this).css("width","auto")})})},initGroupPriceFunctionality:function(){a(document).on("click",
".property-type-groupPrice .trigger-show-group-picker",function(){var c=a(this).closest(".property-type-groupPrice");c.find(".group-picker").show();c.find(".trigger-show-group-picker").hide();c.find(".trigger-cancel-group-picker").show()});a(document).on("click",".property-type-groupPrice .trigger-cancel-group-picker",function(){var c=a(this).closest(".property-type-groupPrice");c.find(".group-picker").hide();c.find(".trigger-show-group-picker").show();c.find(".trigger-cancel-group-picker").hide()});
var b=function(c){var d=[];c.find(".price-overrides .price-override").each(function(){d.push({group_id:a(this).data("group-id"),price:a(this).find(".chosen-price").val()})});c.find(".overrides-json-data").val(window.JSON.stringify(d));var k=d.length,h=c.find(".trigger-add-price-override").length;k>=h?c.find(".trigger-show-group-picker").addClass("hidden"):c.find(".trigger-show-group-picker").removeClass("hidden")};a(document).on("keyup change",".property-type-groupPrice .chosen-price",function(){var c=
a(this).closest(".property-type-groupPrice");b(c)});a(document).on("click",".property-type-groupPrice .trigger-add-price-override",function(){var c=a(this).closest(".property-type-groupPrice"),d=a(this).data("group-id"),k=a(c).find(".price-override-blueprint .price-override").clone();k.attr("data-group-id",d);k.find(".group-title-field").text(a(this).text());c.find(".price-overrides").append(k);a(this).addClass("used-already");c.find(".trigger-cancel-group-picker").trigger("click");b(c)});a(document).on("click",
".property-type-groupPrice .trigger-remove-price-override",function(){var c=a(this).closest(".property-type-groupPrice"),d=a(this).closest(".price-override").data("group-id");a(this).closest(".price-override").remove();c.find(".group-picker .group-id-"+d).removeClass("used-already");b(c)})},initCalculationOverrideFunctionality:function(){a(document).on("click",".property-type-calculationOverride .trigger-show-group-picker",function(){var c=a(this).closest(".property-type-calculationOverride");c.find(".group-picker").show();
c.find(".trigger-show-group-picker").hide();c.find(".trigger-cancel-group-picker").show()});a(document).on("click",".property-type-calculationOverride .trigger-cancel-group-picker",function(){var c=a(this).closest(".property-type-calculationOverride");c.find(".group-picker").hide();c.find(".trigger-show-group-picker").show();c.find(".trigger-cancel-group-picker").hide()});var b=function(c){var d=[];c.find(".price-overrides .price-override").each(function(){d.push({group_id:parseInt(a(this).data("group-id")),
calculation_id:parseInt(a(this).find(".calculation-select").val())})});c.find(".overrides-json-data").val(window.JSON.stringify(d));var k=d.length,h=c.find(".trigger-add-price-override").length;k>=h?c.find(".trigger-show-group-picker").addClass("hidden"):c.find(".trigger-show-group-picker").removeClass("hidden")};a(document).on("change",".property-type-calculationOverride .calculation-select",function(){var c=a(this).closest(".property-type-calculationOverride");b(c)});a(document).on("click",".property-type-calculationOverride .trigger-add-price-override",
function(){var c=a(this).closest(".property-type-calculationOverride"),d=a(this).data("group-id"),k=a(c).find(".price-override-blueprint .price-override").clone();k.attr("data-group-id",d);k.find(".group-title-field").text(a(this).text());d="dummy-id-for-chosen-"+Math.floor(1E4*Math.random());var h=k.find(".calculation-select");h.attr("id",d).attr("name",d);var l=k.find(".trigger-open-join-link-modal");l.attr("data-name-form-control",l.attr("data-name-form-control").replace("PLACEHOLDER_CALC_SELECT",
d));c.find(".price-overrides").append(k);h.chosen({disable_search_threshold:10,search_contains:!0,inherit_select_classes:!0,width:"100%"});a(this).addClass("used-already");c.find(".trigger-cancel-group-picker").trigger("click");b(c)});a(document).on("click",".property-type-calculationOverride .trigger-remove-price-override",function(){var c=a(this).closest(".property-type-calculationOverride"),d=a(this).closest(".price-override").data("group-id");a(this).closest(".price-override").remove();c.find(".group-picker .group-id-"+
d).removeClass("used-already");b(c)})},initCalculationJoinLinks:function(){a(document).on("change",".kenedo-details-form .calculation-select",function(){var b=a(this),c=parseInt(b.val());b=b.closest(".select-and-links").find(".trigger-open-join-link-modal");b.data("selected-id",c);0===c?b.text(b.data("link-text-new")):b.text(b.data("link-text-open"))});a(document).on("click",".trigger-open-join-link-modal",function(){var b=a(this);if(!b.hasClass("disabled")){b.addClass("disabled");var c=b.closest(".select-and-links"),
d=b.closest(".kenedo-details-form"),k=a(".view-admin .configbox-modals"),h=k.children(".join-link-modal");if(0===h.length){h=c.find(".join-link-modal").appendTo(k);var l;h.on("show.bs.modal",function(){l=a(this).siblings(".modal:visible");l.modal("hide")});h.on("hidden.bs.modal",function(){l.modal("show");l=a(".some-div-that-does-not-exists")})}b.data("request-data").id=b.data("selected-id");g.injectHtml(h.find(".modal-content"),b.data("controller"),b.data("task"),b.data("request-data"),function(){b.removeClass("disabled");
h.modal({keyboard:!1});a("html, body").animate({scrollTop:0},100);h.find(".kenedo-details-form").on("cbFormTaskResponseReceived",function(m,p,q){if("store"===q.task||"apply"===q.task){try{var n=JSON.parse(p.responseText)}catch(r){console.warn('Could not parse JSON response. Exception message follows. ResponseText was: "'+p.responseText+'"');console.warn(r);return}!0===n.success&&!0===n.wasInsert&&(d.find("select.calculation-select").each(function(){a(this).append('<option value="'+n.data.id+'">'+
n.data.name+"</option>");a(this).trigger("chosen:updated")}),(m=b.data("name-form-control"))&&d.find("select[name="+m+"]").val(n.data.id).trigger("chosen:updated").trigger("change"))}})})}})},initRulePropertyFunctionality:function(){a(document).on("click",".trigger-delete-rule",function(){a(this).closest(".kenedo-property").find(".data-field").val("").trigger("change");a(this).closest(".kenedo-property").find(".rule-wrapper").removeClass("has-rule").addClass("has-no-rule")});a(document).on("click",
".trigger-copy-rule",function(){var b=a(this).closest(".rule-wrapper");b={productId:b.find(".data-field").data("product-id"),ruleJson:b.find(".data-field").val(),ruleHtml:b.find(".rule-html").html()};f.setClipboardRule(b);a(".trigger-paste-rule").show()});a(document).on("click",".trigger-paste-rule",function(){if(!1!==f.hasClipboardRule()){var b=f.getClipboardRule(),c=a(this).closest(".rule-wrapper"),d=c.find(".data-field").data("product-id");parseInt(b.productId)!==parseInt(d)?window.alert("Rule in clipboard is for another product"):
(c.find(".data-field").val(b.ruleJson),c.find(".rule-html").html(b.ruleHtml),c.removeClass("has-no-rule").addClass("has-rule"))}});a(document).on("click",".trigger-edit-rule",function(){var b=a(this),c=b.closest(".kenedo-property").find(".data-field"),d=c.data("editor-url"),k=a(".view-admin .configbox-modals"),h=k.children(".rule-editor-modal");if(0===h.length){h=b.closest(".kenedo-property").find(".rule-editor-modal").appendTo(k);var l;h.on("show.bs.modal",function(){l=a(this).siblings(".modal:visible");
l.modal("hide")});h.on("hidden.bs.modal",function(){l.modal("show");l=a(".asdfsadfsadf")})}var m={usageIn:c.data("usage-in"),productId:c.data("product-id"),pageId:c.data("page-id"),rule:c.val()};h.find(".modal-content").html("");h.one("show.bs.modal",function(){h.find(".modal-content").load(d,m,function(){h.data("form-property",b.closest(".kenedo-property"));a(document).trigger("cbViewInjected")})});h.modal()})},registerLegacyReadyFunctions:function(){e.registerSubviewReadyFunction("view-adminelement",
function(){0!==a(".view-adminelement .not-using-shapediver").length&&a(".property-group-shapediver_start").addClass("hidden")});e.registerSubviewReadyFunction("view-adminoptionassignment",function(){0!==a(".view-adminoptionassignment .not-using-shapediver").length&&a(".property-group-shapediver_start").addClass("hidden")});e.registerSubviewReadyFunction("view-adminmainmenu",function(){a(document).on("click",".view-adminmainmenu .trigger-toggle-sub-items",function(){a(this).toggleClass("opened");a(this).closest(".menu-list-item").children(".sub-items").toggleClass("opened")})});
e.registerSubviewReadyFunction("view-admintemplate",function(){cbrequire(["configbox/server"],function(b){e.addStylesheet(b.config.urlSystemAssets+"/kenedo/external/codemirror-5.30.0/lib/codemirror.css?version="+b.config.cacheVar)});cbrequire(["codemirror","codemirror/mode/htmlmixed/htmlmixed","codemirror/mode/php/php","codemirror/mode/javascript/javascript"],function(b){b.fromTextArea(document.getElementById("template-code"),{lineNumbers:!0,matchBrackets:!0,mode:"php",indentUnit:4,indentWithTabs:!0,
viewportMargin:Infinity}).on("change",function(c){a("#template-code").val(c.getValue())})})})},runLegacyReadyFunctions:function(b){var c=b.data("view-id");(b=c?"view-"+c:b.find(".kenedo-view").eq(0).attr("id"))&&e.runSubviewReadyFunctions(b)}};return{initBackendOnce:function(){f.registerLegacyReadyFunctions();f.initRulePropertyFunctionality();f.initGroupPriceFunctionality();f.initCalculationOverrideFunctionality();f.initCalculationJoinLinks();e.initAdminPageOnce()},initBackendEach:function(b){f.initKenedoForm(b);
f.initChosenDropdowns(b);f.initHtmlEditors(b);f.initDatePickers(b);f.initSortables(b);f.initRulePasteButtonVisibility(b);f.runLegacyReadyFunctions(b);e.initAdminPageEach(b)}}});
