var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.findInternal=function(a,d,h){a instanceof String&&(a=String(a));for(var e=a.length,b=0;b<e;b++){var c=a[b];if(d.call(h,c,b,a))return{i:b,v:c}}return{i:-1,v:void 0}};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.SIMPLE_FROUND_POLYFILL=!1;
$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(a,d,h){a!=Array.prototype&&a!=Object.prototype&&(a[d]=h.value)};$jscomp.getGlobal=function(a){a=["object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof global&&global,a];for(var d=0;d<a.length;++d){var h=a[d];if(h&&h.Math==Math)return h}return globalThis};$jscomp.global=$jscomp.getGlobal(this);
$jscomp.polyfill=function(a,d,h,e){if(d){h=$jscomp.global;a=a.split(".");for(e=0;e<a.length-1;e++){var b=a[e];b in h||(h[b]={});h=h[b]}a=a[a.length-1];e=h[a];d=d(e);d!=e&&null!=d&&$jscomp.defineProperty(h,a,{configurable:!0,writable:!0,value:d})}};$jscomp.polyfill("Array.prototype.find",function(a){return a?a:function(a,h){return $jscomp.findInternal(this,a,h).v}},"es6","es3");
define(["cbj","kenedo","configbox/server","cbj.ui","cbj.bootstrap"],function(a,d,h){var e={initOffCanvasToggle:function(){a(document).on("click",".trigger-toggle-offcanvas",function(){a(".row-offcanvas").toggleClass("active");a(this).toggleClass("fa-bars").toggleClass("fa-window-close")})},initHtmlEditors:function(b){0!==b.find(".kenedo-html-editor.not-initialized").length&&cbrequire(["tinyMCE","configbox/server"],function(c,k){try{b.find(".kenedo-html-editor.not-initialized").each(function(){var b=
a(this),f=a(this).get(0);b.removeClass("not-initialized");c.init({convert_urls:!1,document_base_url:k.config.urlBase,documentBaseURL:k.config.urlBase,baseURL:k.config.urlTinyMceBase,suffix:!0===k.config.useMinifiedJs?".min":"",target:f,plugins:["advlist autolink link image lists charmap print preview hr anchor pagebreak spellchecker","searchreplace wordcount visualblocks visualchars code fullscreen insertdatetime nonbreaking","save table directionality emoticons template paste"],toolbar:"insertfile undo redo | styleselect | bold italic | alignleft aligncenter alignright alignjustify | bullist numlist outdent indent | l      ink image | print preview media fullpage | forecolor backcolor emoticons",
template_external_list_url:"js/template_list.js",external_link_list_url:"js/link_list.js",external_image_list_url:"js/image_list.js",media_external_list_url:"js/media_list.js",style_formats:[{title:"Headers",items:[{title:"Header 1",format:"h1"},{title:"Header 2",format:"h2"},{title:"Header 3",format:"h3"},{title:"Header 4",format:"h4"},{title:"Header 5",format:"h5"},{title:"Header 6",format:"h6"}]},{title:"Inline",items:[{title:"Bold",icon:"bold",format:"bold"},{title:"Italic",icon:"italic",format:"italic"},
{title:"Underline",icon:"underline",format:"underline"},{title:"Strikethrough",icon:"strikethrough",format:"strikethrough"},{title:"Superscript",icon:"superscript",format:"superscript"},{title:"Subscript",icon:"subscript",format:"subscript"},{title:"Code",icon:"code",format:"code"}]},{title:"Blocks",items:[{title:"Paragraph",format:"p"},{title:"Blockquote",format:"blockquote"},{title:"Div",format:"div"},{title:"Pre",format:"pre"}]},{title:"Alignment",items:[{title:"Left",icon:"alignleft",format:"alignleft"},
{title:"Center",icon:"aligncenter",format:"aligncenter"},{title:"Right",icon:"alignright",format:"alignright"},{title:"Justify",icon:"alignjustify",format:"alignjustify"}]},{title:"Others",items:[{title:"Custom 1",selector:"p",classes:"custom-1"},{title:"Custom 2",selector:"p",classes:"custom-2"},{title:"Custom 3",selector:"p",classes:"custom-3"},{title:"Custom 4",selector:"p",classes:"custom-4"}]}]})})}catch(g){console.log("Init of TinyMCE failed. Error message was "+g)}})},initKenedoForm:function(b){a(b).find(".kenedo-details-form").each(function(){var c=
a(this).closest(".kenedo-details-form").data("record");d.setPropertyVisibility(null,c,a(this));a(this).on("kenedoFormDataChanged",d.setPropertyVisibility)})},initDatePickers:function(b){a(b).find(".datepicker").datepicker({dateFormat:"yy-mm-dd"});a(b).find(".kenedo-datepicker").each(function(){var c=a(this).closest(".kenedo-property").find(".form-control"),b=c.val();c={dateFormat:"yy-mm-dd",altFormat:"yy-mm-dd",altField:c};a(this).datepicker(c);b&&"0000-00-00"!==b&&a(this).datepicker("setDate",b)})},
initSortables:function(b){a(b).find(".sortable-listing tbody").sortable({handle:".sort-handle",items:"tr",axis:"y",scroll:!1,helper:function(c,b){b.children().each(function(){a(this).width(a(this).width())});return b},start:function(){var c=[],b=[],g=a(this).sortable("toArray"),f;for(f in g)!0===g.hasOwnProperty(f)&&(c.push(a("#"+g[f]+" .ordering-text-field").val()),b.push(g[f].replace("item-id-","")));a(this).data("currentOrdering",c);a(this).data("currentItemIds",b)},update:function(){a(this).closest(".kenedo-listing-form").find(".trigger-store-record-ordering").show();
var b=[],k=[],g=a(this).data("currentOrdering"),f=a(this).sortable("toArray"),d;for(d in f)!0===f.hasOwnProperty(d)&&(k.push(f[d].replace("item-id-","")),b.push(g[d]));for(var e in b)!0===b.hasOwnProperty(e)&&a(this).find("#item-id-"+k[e]+" .ordering-text-field").val(g[e]);g=b;a(this).data("currentOrdering",g);a(this).data("currentItemIds",k)}})},initChosenDropdowns:function(b){0<a(b).find("select.listing-filter, select.join-select, .property-type-dropdown select, select.make-me-chosen, select.chosen-dropdown").length&&
cbrequire(["cbj.chosen"],function(){a(b).find("select.listing-filter, select.join-select, .property-type-dropdown select, select.make-me-chosen, select.chosen-dropdown").chosen({disable_search_threshold:10,search_contains:!0,inherit_select_classes:!0,width:"100%"});a(b).find(".chosen-container:hidden").each(function(){a(this).is(".join-select")?a(this).css("width","100%"):a(this).closest(".kenedo-properties").length?a(this).css("width","100%"):a(this).css("width","auto")})})},initGroupPriceFunctionality:function(){a(document).on("click",
".property-type-groupPrice .trigger-show-group-picker",function(){var b=a(this).closest(".property-type-groupPrice");b.find(".group-picker").show();b.find(".trigger-show-group-picker").hide();b.find(".trigger-cancel-group-picker").show()});a(document).on("click",".property-type-groupPrice .trigger-cancel-group-picker",function(){var b=a(this).closest(".property-type-groupPrice");b.find(".group-picker").hide();b.find(".trigger-show-group-picker").show();b.find(".trigger-cancel-group-picker").hide()});
var b=function(b){var c=[];b.find(".price-overrides .price-override").each(function(){c.push({group_id:a(this).data("group-id"),price:a(this).find(".chosen-price").val()})});b.find(".overrides-json-data").val(window.JSON.stringify(c));var g=c.length,f=b.find(".trigger-add-price-override").length;g>=f?b.find(".trigger-show-group-picker").addClass("hidden"):b.find(".trigger-show-group-picker").removeClass("hidden")};a(document).on("keyup change",".property-type-groupPrice .chosen-price",function(){var c=
a(this).closest(".property-type-groupPrice");b(c)});a(document).on("click",".property-type-groupPrice .trigger-add-price-override",function(){var c=a(this).closest(".property-type-groupPrice"),d=a(this).data("group-id"),g=a(c).find(".price-override-blueprint .price-override").clone();g.attr("data-group-id",d);g.find(".group-title-field").text(a(this).text());c.find(".price-overrides").append(g);a(this).addClass("used-already");c.find(".trigger-cancel-group-picker").trigger("click");b(c)});a(document).on("click",
".property-type-groupPrice .trigger-remove-price-override",function(){var c=a(this).closest(".property-type-groupPrice"),d=a(this).closest(".price-override").data("group-id");a(this).closest(".price-override").remove();c.find(".group-picker .group-id-"+d).removeClass("used-already");b(c)})},initCalculationOverrideFunctionality:function(){a(document).on("click",".property-type-calculationOverride .trigger-show-group-picker",function(){var b=a(this).closest(".property-type-calculationOverride");b.find(".group-picker").show();
b.find(".trigger-show-group-picker").hide();b.find(".trigger-cancel-group-picker").show()});a(document).on("click",".property-type-calculationOverride .trigger-cancel-group-picker",function(){var b=a(this).closest(".property-type-calculationOverride");b.find(".group-picker").hide();b.find(".trigger-show-group-picker").show();b.find(".trigger-cancel-group-picker").hide()});var b=function(b){var c=[];b.find(".price-overrides .price-override").each(function(){c.push({group_id:parseInt(a(this).data("group-id")),
calculation_id:parseInt(a(this).find(".calculation-select").val())})});b.find(".overrides-json-data").val(window.JSON.stringify(c));var d=c.length,f=b.find(".trigger-add-price-override").length;d>=f?b.find(".trigger-show-group-picker").addClass("hidden"):b.find(".trigger-show-group-picker").removeClass("hidden")};a(document).on("change",".property-type-calculationOverride .calculation-select",function(){var c=a(this).closest(".property-type-calculationOverride");b(c)});a(document).on("click",".property-type-calculationOverride .trigger-add-price-override",
function(){var c=a(this).closest(".property-type-calculationOverride"),d=a(this).data("group-id"),g=a(c).find(".price-override-blueprint .price-override").clone();g.attr("data-group-id",d);g.find(".group-title-field").text(a(this).text());d="dummy-id-for-chosen-"+Math.floor(1E4*Math.random());var f=g.find(".calculation-select");f.attr("id",d).attr("name",d);var e=g.find(".trigger-open-join-link-modal");e.attr("data-name-form-control",e.attr("data-name-form-control").replace("PLACEHOLDER_CALC_SELECT",
d));c.find(".price-overrides").append(g);f.chosen({disable_search_threshold:10,search_contains:!0,inherit_select_classes:!0,width:"100%"});a(this).addClass("used-already");c.find(".trigger-cancel-group-picker").trigger("click");b(c)});a(document).on("click",".property-type-calculationOverride .trigger-remove-price-override",function(){var c=a(this).closest(".property-type-calculationOverride"),d=a(this).closest(".price-override").data("group-id");a(this).closest(".price-override").remove();c.find(".group-picker .group-id-"+
d).removeClass("used-already");b(c)})},initCalculationJoinLinks:function(){a(document).on("change",".kenedo-details-form .calculation-select",function(){var b=a(this),c=parseInt(b.val());b=b.closest(".select-and-links").find(".trigger-open-join-link-modal");b.data("selected-id",c);0===c?b.text(b.data("link-text-new")):b.text(b.data("link-text-open"))});a(document).on("click",".trigger-open-join-link-modal",function(){var b=a(this);if(!b.hasClass("disabled")){b.addClass("disabled");var c=b.closest(".select-and-links"),
d=b.closest(".kenedo-details-form"),e=a(".view-admin .configbox-modals"),f=e.children(".join-link-modal");if(0===f.length){f=c.find(".join-link-modal").appendTo(e);var l;f.on("show.bs.modal",function(){l=a(this).siblings(".modal:visible");l.modal("hide")});f.on("hidden.bs.modal",function(){l.modal("show");l=a(".some-div-that-does-not-exists")})}b.data("request-data").id=b.data("selected-id");h.injectHtml(f.find(".modal-content"),b.data("controller"),b.data("task"),b.data("request-data"),function(){b.removeClass("disabled");
f.modal({keyboard:!1});a("html, body").animate({scrollTop:0},100);f.find(".kenedo-details-form").on("cbFormTaskResponseReceived",function(c,f,e){if("store"===e.task||"apply"===e.task){try{var g=JSON.parse(f.responseText)}catch(n){console.warn('Could not parse JSON response. Exception message follows. ResponseText was: "'+f.responseText+'"');console.warn(n);return}!0===g.success&&!0===g.wasInsert&&(d.find("select.calculation-select").each(function(){a(this).append('<option value="'+g.data.id+'">'+
g.data.name+"</option>");a(this).trigger("chosen:updated")}),(c=b.data("name-form-control"))&&d.find("select[name="+c+"]").val(g.data.id).trigger("chosen:updated").trigger("change"))}})})}})},initRulePropertyFunctionality:function(){a(document).on("click",".trigger-delete-rule",function(){a(this).closest(".kenedo-property").find(".data-field").val("").trigger("change");a(this).closest(".kenedo-property").find(".rule-wrapper").removeClass("has-rule").addClass("has-no-rule")});a(document).on("click",
".trigger-edit-rule",function(){var b=a(this),c=b.closest(".kenedo-property").find(".data-field"),d=c.data("editor-url"),e=a(".view-admin .configbox-modals"),f=e.children(".rule-editor-modal");if(0===f.length){f=b.closest(".kenedo-property").find(".rule-editor-modal").appendTo(e);var h;f.on("show.bs.modal",function(){h=a(this).siblings(".modal:visible");h.modal("hide")});f.on("hidden.bs.modal",function(){h.modal("show");h=a(".asdfsadfsadf")})}var m={usageIn:c.data("usage-in"),productId:c.data("product-id"),
pageId:c.data("page-id"),rule:c.val()};f.find(".modal-content").html("");f.one("show.bs.modal",function(){f.find(".modal-content").load(d,m,function(){f.data("form-property",b.closest(".kenedo-property"));a(document).trigger("cbViewInjected")})});f.modal()})},registerLegacyReadyFunctions:function(){d.registerSubviewReadyFunction("view-adminelement",function(){0!==a(".view-adminelement .not-using-shapediver").length&&a(".property-group-shapediver_start").addClass("hidden")});d.registerSubviewReadyFunction("view-adminoptionassignment",
function(){0!==a(".view-adminoptionassignment .not-using-shapediver").length&&a(".property-group-shapediver_start").addClass("hidden")});d.registerSubviewReadyFunction("view-adminmainmenu",function(){a(document).on("click",".view-adminmainmenu .trigger-toggle-sub-items",function(){a(this).toggleClass("opened");a(this).closest(".menu-list-item").children(".sub-items").toggleClass("opened")})});d.registerSubviewReadyFunction("view-admintemplate",function(){cbrequire(["configbox/server"],function(a){d.addStylesheet(a.config.urlSystemAssets+
"/kenedo/external/codemirror-5.30.0/lib/codemirror.css?version="+a.config.cacheVar)});cbrequire(["codemirror","codemirror/mode/htmlmixed/htmlmixed","codemirror/mode/php/php","codemirror/mode/javascript/javascript"],function(b){b.fromTextArea(document.getElementById("template-code"),{lineNumbers:!0,matchBrackets:!0,mode:"php",indentUnit:4,indentWithTabs:!0,viewportMargin:Infinity}).on("change",function(b){a("#template-code").val(b.getValue())})})})},runLegacyReadyFunctions:function(a){var b=a.data("view-id");
(a=b?"view-"+b:a.find(".kenedo-view").eq(0).attr("id"))&&d.runSubviewReadyFunctions(a)}};return{initBackendOnce:function(){e.registerLegacyReadyFunctions();e.initOffCanvasToggle();e.initRulePropertyFunctionality();e.initGroupPriceFunctionality();e.initCalculationOverrideFunctionality();e.initCalculationJoinLinks();d.initAdminPageOnce()},initBackendEach:function(a){e.initKenedoForm(a);e.initChosenDropdowns(a);e.initHtmlEditors(a);e.initDatePickers(a);e.initSortables(a);e.runLegacyReadyFunctions(a);
d.initAdminPageEach(a)}}});
