var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.findInternal=function(a,c,g){a instanceof String&&(a=String(a));for(var e=a.length,b=0;b<e;b++){var d=a[b];if(c.call(g,d,b,a))return{i:b,v:d}}return{i:-1,v:void 0}};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.SIMPLE_FROUND_POLYFILL=!1;
$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(a,c,g){a!=Array.prototype&&a!=Object.prototype&&(a[c]=g.value)};$jscomp.getGlobal=function(a){a=["object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof global&&global,a];for(var c=0;c<a.length;++c){var g=a[c];if(g&&g.Math==Math)return g}return globalThis};$jscomp.global=$jscomp.getGlobal(this);
$jscomp.polyfill=function(a,c,g,e){if(c){g=$jscomp.global;a=a.split(".");for(e=0;e<a.length-1;e++){var b=a[e];b in g||(g[b]={});g=g[b]}a=a[a.length-1];e=g[a];c=c(e);c!=e&&null!=c&&$jscomp.defineProperty(g,a,{configurable:!0,writable:!0,value:c})}};$jscomp.polyfill("Array.prototype.find",function(a){return a?a:function(a,g){return $jscomp.findInternal(this,a,g).v}},"es6","es3");
define(["cbj","kenedo","configbox/server","cbj.ui","cbj.bootstrap"],function(a,c,g){var e={initHtmlEditors:function(b){0!==b.find(".kenedo-html-editor.not-initialized").length&&cbrequire(["tinyMCE","configbox/server"],function(d,h){try{b.find(".kenedo-html-editor.not-initialized").each(function(){var b=a(this),f=a(this).get(0);b.removeClass("not-initialized");d.init({convert_urls:!1,document_base_url:h.config.urlBase,documentBaseURL:h.config.urlBase,baseURL:h.config.urlTinyMceBase,suffix:!0===h.config.useMinifiedJs?
".min":"",target:f,plugins:["advlist autolink link image lists charmap print preview hr anchor pagebreak spellchecker","searchreplace wordcount visualblocks visualchars code fullscreen insertdatetime nonbreaking","save table directionality emoticons template paste"],toolbar:"insertfile undo redo | styleselect | bold italic | alignleft aligncenter alignright alignjustify | bullist numlist outdent indent | link image | print preview media fullpage | forecolor backcolor emoticons",template_external_list_url:"js/template_list.js",
external_link_list_url:"js/link_list.js",external_image_list_url:"js/image_list.js",media_external_list_url:"js/media_list.js",style_formats:[{title:"Headers",items:[{title:"Header 1",format:"h1"},{title:"Header 2",format:"h2"},{title:"Header 3",format:"h3"},{title:"Header 4",format:"h4"},{title:"Header 5",format:"h5"},{title:"Header 6",format:"h6"}]},{title:"Inline",items:[{title:"Bold",icon:"bold",format:"bold"},{title:"Italic",icon:"italic",format:"italic"},{title:"Underline",icon:"underline",
format:"underline"},{title:"Strikethrough",icon:"strikethrough",format:"strikethrough"},{title:"Superscript",icon:"superscript",format:"superscript"},{title:"Subscript",icon:"subscript",format:"subscript"},{title:"Code",icon:"code",format:"code"}]},{title:"Blocks",items:[{title:"Paragraph",format:"p"},{title:"Blockquote",format:"blockquote"},{title:"Div",format:"div"},{title:"Pre",format:"pre"}]},{title:"Alignment",items:[{title:"Left",icon:"alignleft",format:"alignleft"},{title:"Center",icon:"aligncenter",
format:"aligncenter"},{title:"Right",icon:"alignright",format:"alignright"},{title:"Justify",icon:"alignjustify",format:"alignjustify"}]},{title:"Others",items:[{title:"Custom 1",selector:"p",classes:"custom-1"},{title:"Custom 2",selector:"p",classes:"custom-2"},{title:"Custom 3",selector:"p",classes:"custom-3"},{title:"Custom 4",selector:"p",classes:"custom-4"}]}]})})}catch(l){console.log("Init of TinyMCE failed. Error message was "+l)}})},initKenedoForm:function(b){a(b).find(".kenedo-details-form").each(function(){var b=
a(this).closest(".kenedo-details-form").data("record");c.setPropertyVisibility(null,b,a(this));a(this).on("kenedoFormDataChanged",c.setPropertyVisibility)})},initDatePickers:function(b){a(b).find(".datepicker").datepicker({dateFormat:"yy-mm-dd"});a(b).find(".kenedo-datepicker").each(function(){var b=a(this).closest(".kenedo-property").find(".form-control"),h=b.val();if(""===h||"0000-00-00"===h||"0000-00-00 00:00:00"===h)h=null;b={dateFormat:"yy-mm-dd",altFormat:"yy-mm-dd",altField:b};a(this).datepicker(b);
a(this).datepicker("setDate",h)})},initSortables:function(b){a(b).find(".sortable-listing tbody").sortable({handle:".sort-handle",items:"tr",axis:"y",scroll:!1,helper:function(b,h){h.children().each(function(){a(this).width(a(this).width())});return h},start:function(){var b=a(this).closest(".kenedo-listing-form");0!=c.getListParameter(b,"limit")&&((b=a(this).find(".sort-handle:first").data("unset-pagination-text"))?alert(b):alert("Please set items per page to all first"))},update:function(){var b=
a(this).closest(".kenedo-listing-form"),h=c.getListParameter(b,"listing_order_dir"),l={};var f="asc"===h.toLowerCase()?10:10*b.find(".item-row").length;b.find(".item-row").each(function(){var b=a(this).data("item-id");l[b]=f;f="asc"===h.toLowerCase()?f+10:f-10});var k=c.getListParameter(b,"controller"),m=JSON.stringify(l);e.sortingTimeout&&window.clearTimeout(e.sortingTimeout);e.sortingTimeout=window.setTimeout(function(){g.makeRequest(k,"storeOrdering",{updates:m})},500)}})},sortingTimeout:null,
initRulePasteButtonVisibility:function(a){this.hasClipboardRule()?a.find(".rule-wrapper .trigger-paste-rule").show():a.find(".rule-wrapper .trigger-paste-rule").hide()},hasClipboardRule:function(){return null!==this.getClipboardRule()},setClipboardRule:function(a){window.sessionStorage.setItem("clipboardRule",JSON.stringify(a))},getClipboardRule:function(){var a=window.sessionStorage.getItem("clipboardRule");return null===a?null:JSON.parse(a)},initChosenDropdowns:function(b){0<a(b).find("select.listing-filter, select.join-select, .property-type-dropdown select, select.make-me-chosen, select.chosen-dropdown").length&&
cbrequire(["cbj.chosen"],function(){a(b).find("select.listing-filter, select.join-select, .property-type-dropdown select, select.make-me-chosen, select.chosen-dropdown").chosen({disable_search_threshold:10,search_contains:!0,inherit_select_classes:!0,width:"100%"});a(b).find(".chosen-container:hidden").each(function(){a(this).is(".join-select")?a(this).css("width","100%"):a(this).closest(".kenedo-properties").length?a(this).css("width","100%"):a(this).css("width","auto")})})},initGroupPriceFunctionality:function(){a(document).on("click",
".property-type-groupPrice .trigger-show-group-picker",function(){var b=a(this).closest(".property-type-groupPrice");b.find(".group-picker").show();b.find(".trigger-show-group-picker").hide();b.find(".trigger-cancel-group-picker").show()});a(document).on("click",".property-type-groupPrice .trigger-cancel-group-picker",function(){var b=a(this).closest(".property-type-groupPrice");b.find(".group-picker").hide();b.find(".trigger-show-group-picker").show();b.find(".trigger-cancel-group-picker").hide()});
var b=function(b){var d=[];b.find(".price-overrides .price-override").each(function(){d.push({group_id:a(this).data("group-id"),price:a(this).find(".chosen-price").val()})});b.find(".overrides-json-data").val(window.JSON.stringify(d));var c=d.length,f=b.find(".trigger-add-price-override").length;c>=f?b.find(".trigger-show-group-picker").addClass("hidden"):b.find(".trigger-show-group-picker").removeClass("hidden")};a(document).on("keyup change",".property-type-groupPrice .chosen-price",function(){var d=
a(this).closest(".property-type-groupPrice");b(d)});a(document).on("click",".property-type-groupPrice .trigger-add-price-override",function(){var d=a(this).closest(".property-type-groupPrice"),h=a(this).data("group-id"),c=a(d).find(".price-override-blueprint .price-override").clone();c.attr("data-group-id",h);c.find(".group-title-field").text(a(this).text());d.find(".price-overrides").append(c);a(this).addClass("used-already");d.find(".trigger-cancel-group-picker").trigger("click");b(d)});a(document).on("click",
".property-type-groupPrice .trigger-remove-price-override",function(){var d=a(this).closest(".property-type-groupPrice"),h=a(this).closest(".price-override").data("group-id");a(this).closest(".price-override").remove();d.find(".group-picker .group-id-"+h).removeClass("used-already");b(d)})},initCalculationOverrideFunctionality:function(){a(document).on("click",".property-type-calculationOverride .trigger-show-group-picker",function(){var b=a(this).closest(".property-type-calculationOverride");b.find(".group-picker").show();
b.find(".trigger-show-group-picker").hide();b.find(".trigger-cancel-group-picker").show()});a(document).on("click",".property-type-calculationOverride .trigger-cancel-group-picker",function(){var b=a(this).closest(".property-type-calculationOverride");b.find(".group-picker").hide();b.find(".trigger-show-group-picker").show();b.find(".trigger-cancel-group-picker").hide()});var b=function(b){var d=[];b.find(".price-overrides .price-override").each(function(){d.push({group_id:parseInt(a(this).data("group-id")),
calculation_id:parseInt(a(this).find(".calculation-select").val())})});b.find(".overrides-json-data").val(window.JSON.stringify(d));var c=d.length,f=b.find(".trigger-add-price-override").length;c>=f?b.find(".trigger-show-group-picker").addClass("hidden"):b.find(".trigger-show-group-picker").removeClass("hidden")};a(document).on("change",".property-type-calculationOverride .calculation-select",function(){var d=a(this).closest(".property-type-calculationOverride");b(d)});a(document).on("click",".property-type-calculationOverride .trigger-add-price-override",
function(){var d=a(this).closest(".property-type-calculationOverride"),c=a(this).data("group-id"),e=a(d).find(".price-override-blueprint .price-override").clone();e.attr("data-group-id",c);e.find(".group-title-field").text(a(this).text());c="dummy-id-for-chosen-"+Math.floor(1E4*Math.random());var f=e.find(".calculation-select");f.attr("id",c).attr("name",c);var g=e.find(".trigger-open-join-link-modal");g.attr("data-name-form-control",g.attr("data-name-form-control").replace("PLACEHOLDER_CALC_SELECT",
c));d.find(".price-overrides").append(e);f.chosen({disable_search_threshold:10,search_contains:!0,inherit_select_classes:!0,width:"100%"});a(this).addClass("used-already");d.find(".trigger-cancel-group-picker").trigger("click");b(d)});a(document).on("click",".property-type-calculationOverride .trigger-remove-price-override",function(){var d=a(this).closest(".property-type-calculationOverride"),c=a(this).closest(".price-override").data("group-id");a(this).closest(".price-override").remove();d.find(".group-picker .group-id-"+
c).removeClass("used-already");b(d)})},initCalculationJoinLinks:function(){a(document).on("change",".kenedo-details-form .calculation-select",function(){var b=a(this),d=parseInt(b.val());b=b.closest(".select-and-links").find(".trigger-open-join-link-modal");b.data("selected-id",d);0===d?b.text(b.data("link-text-new")):b.text(b.data("link-text-open"))});a(document).on("click",".trigger-open-join-link-modal",function(){var b=a(this);if(!b.hasClass("disabled")){b.addClass("disabled");var d=b.closest(".select-and-links"),
c=b.closest(".kenedo-details-form"),e=a(".view-admin .configbox-modals"),f=e.children(".join-link-modal");if(0===f.length){f=d.find(".join-link-modal").appendTo(e);var k;f.on("show.bs.modal",function(){k=a(this).siblings(".modal:visible");k.modal("hide")});f.on("hidden.bs.modal",function(){k.modal("show");k=a(".some-div-that-does-not-exists")})}b.data("request-data").id=b.data("selected-id");g.injectHtml(f.find(".modal-content"),b.data("controller"),b.data("task"),b.data("request-data"),function(){b.removeClass("disabled");
f.modal({keyboard:!1});a("html, body").animate({scrollTop:0},100);f.find(".kenedo-details-form").on("cbFormTaskResponseReceived",function(d,e,f){if("store"===f.task||"apply"===f.task){try{var h=JSON.parse(e.responseText)}catch(n){console.warn('Could not parse JSON response. Exception message follows. ResponseText was: "'+e.responseText+'"');console.warn(n);return}!0===h.success&&!0===h.wasInsert&&(c.find("select.calculation-select").each(function(){a(this).append('<option value="'+h.data.id+'">'+
h.data.name+"</option>");a(this).trigger("chosen:updated")}),(d=b.data("name-form-control"))&&c.find("select[name="+d+"]").val(h.data.id).trigger("chosen:updated").trigger("change"))}})})}})},initRulePropertyFunctionality:function(){a(document).on("click",".trigger-delete-rule",function(){a(this).closest(".kenedo-property").find(".data-field").val("").trigger("change");a(this).closest(".kenedo-property").find(".rule-wrapper").removeClass("has-rule").addClass("has-no-rule")});a(document).on("click",
".trigger-copy-rule",function(){var b=a(this).closest(".rule-wrapper");b={productId:b.find(".data-field").data("product-id"),ruleJson:b.find(".data-field").val(),ruleHtml:b.find(".rule-html").html()};e.setClipboardRule(b);a(".trigger-paste-rule").show()});a(document).on("click",".trigger-paste-rule",function(){if(!1!==e.hasClipboardRule()){var b=e.getClipboardRule(),d=a(this).closest(".rule-wrapper"),c=d.find(".data-field").data("product-id");parseInt(b.productId)!==parseInt(c)?window.alert("Rule in clipboard is for another product"):
(d.find(".data-field").val(b.ruleJson),d.find(".rule-html").html(b.ruleHtml),d.removeClass("has-no-rule").addClass("has-rule"))}});a(document).on("click",".trigger-edit-rule",function(){var b=a(this),d=b.closest(".kenedo-property").find(".data-field"),c=d.data("editor-url"),e=a(".view-admin .configbox-modals"),f=e.children(".rule-editor-modal");if(0===f.length){f=b.closest(".kenedo-property").find(".rule-editor-modal").appendTo(e);var g;f.on("show.bs.modal",function(){g=a(this).siblings(".modal:visible");
g.modal("hide")});f.on("hidden.bs.modal",function(){g.modal("show");g=a(".asdfsadfsadf")})}var m={usageIn:d.data("usage-in"),productId:d.data("product-id"),pageId:d.data("page-id"),rule:d.val()};f.find(".modal-content").html("");f.one("show.bs.modal",function(){f.find(".modal-content").load(c,m,function(){f.data("form-property",b.closest(".kenedo-property"));a(document).trigger("cbViewInjected")})});f.modal()})},registerLegacyReadyFunctions:function(){c.registerSubviewReadyFunction("view-adminelement",
function(){0!==a(".view-adminelement .not-using-shapediver").length&&a(".property-group-shapediver_start").addClass("hidden")});c.registerSubviewReadyFunction("view-adminoptionassignment",function(){0!==a(".view-adminoptionassignment .not-using-shapediver").length&&a(".property-group-shapediver_start").addClass("hidden")});c.registerSubviewReadyFunction("view-adminmainmenu",function(){a(document).on("click",".view-adminmainmenu .trigger-toggle-sub-items",function(){a(this).toggleClass("opened");a(this).closest(".menu-list-item").children(".sub-items").toggleClass("opened")})});
c.registerSubviewReadyFunction("view-admintemplate",function(){cbrequire(["configbox/server"],function(b){c.addStylesheet(b.config.urlSystemAssets+"/kenedo/external/codemirror-5.30.0/lib/codemirror.css?version="+b.config.cacheVar)});cbrequire(["codemirror","codemirror/mode/htmlmixed/htmlmixed","codemirror/mode/php/php","codemirror/mode/javascript/javascript"],function(b){b.fromTextArea(document.getElementById("template-code"),{lineNumbers:!0,matchBrackets:!0,mode:"php",indentUnit:4,indentWithTabs:!0,
viewportMargin:Infinity}).on("change",function(b){a("#template-code").val(b.getValue())})})})},runLegacyReadyFunctions:function(b){var a=b.data("view-id");(b=a?"view-"+a:b.find(".kenedo-view").eq(0).attr("id"))&&c.runSubviewReadyFunctions(b)}};return{initBackendOnce:function(){e.registerLegacyReadyFunctions();e.initRulePropertyFunctionality();e.initGroupPriceFunctionality();e.initCalculationOverrideFunctionality();e.initCalculationJoinLinks();c.initAdminPageOnce()},initBackendEach:function(a){e.initKenedoForm(a);
e.initChosenDropdowns(a);e.initHtmlEditors(a);e.initDatePickers(a);e.initSortables(a);e.initRulePasteButtonVisibility(a);e.runLegacyReadyFunctions(a);c.initAdminPageEach(a)}}});
