var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.findInternal=function(a,e,h){a instanceof String&&(a=String(a));for(var c=a.length,b=0;b<c;b++){var d=a[b];if(e.call(h,d,b,a))return{i:b,v:d}}return{i:-1,v:void 0}};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.SIMPLE_FROUND_POLYFILL=!1;
$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(a,e,h){a!=Array.prototype&&a!=Object.prototype&&(a[e]=h.value)};$jscomp.getGlobal=function(a){a=["object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof global&&global,a];for(var e=0;e<a.length;++e){var h=a[e];if(h&&h.Math==Math)return h}return globalThis};$jscomp.global=$jscomp.getGlobal(this);
$jscomp.polyfill=function(a,e,h,c){if(e){h=$jscomp.global;a=a.split(".");for(c=0;c<a.length-1;c++){var b=a[c];b in h||(h[b]={});h=h[b]}a=a[a.length-1];c=h[a];e=e(c);e!=c&&null!=e&&$jscomp.defineProperty(h,a,{configurable:!0,writable:!0,value:e})}};$jscomp.polyfill("Array.prototype.find",function(a){return a?a:function(a,h){return $jscomp.findInternal(this,a,h).v}},"es6","es3");
define(["cbj","kenedo","configbox/server","cbj.ui","cbj.bootstrap"],function(a,e,h){var c={initOffCanvasToggle:function(){a(document).on("click",".trigger-toggle-offcanvas",function(){a(".row-offcanvas").toggleClass("active");a(this).toggleClass("fa-bars").toggleClass("fa-window-close")})},initHtmlEditors:function(b){0!==b.find(".kenedo-html-editor.not-initialized").length&&cbrequire(["tinyMCE","configbox/server"],function(d,g){try{b.find(".kenedo-html-editor.not-initialized").each(function(){var b=
a(this),f=a(this).get(0);b.removeClass("not-initialized");d.init({convert_urls:!1,document_base_url:g.config.urlBase,documentBaseURL:g.config.urlBase,baseURL:g.config.urlTinyMceBase,suffix:!0===g.config.useMinifiedJs?".min":"",target:f,plugins:["advlist autolink link image lists charmap print preview hr anchor pagebreak spellchecker","searchreplace wordcount visualblocks visualchars code fullscreen insertdatetime nonbreaking","save table directionality emoticons template paste"],toolbar:"insertfile undo redo | styleselect | bold italic | alignleft aligncenter alignright alignjustify | bullist numlist outdent indent | l      ink image | print preview media fullpage | forecolor backcolor emoticons",
template_external_list_url:"js/template_list.js",external_link_list_url:"js/link_list.js",external_image_list_url:"js/image_list.js",media_external_list_url:"js/media_list.js",style_formats:[{title:"Headers",items:[{title:"Header 1",format:"h1"},{title:"Header 2",format:"h2"},{title:"Header 3",format:"h3"},{title:"Header 4",format:"h4"},{title:"Header 5",format:"h5"},{title:"Header 6",format:"h6"}]},{title:"Inline",items:[{title:"Bold",icon:"bold",format:"bold"},{title:"Italic",icon:"italic",format:"italic"},
{title:"Underline",icon:"underline",format:"underline"},{title:"Strikethrough",icon:"strikethrough",format:"strikethrough"},{title:"Superscript",icon:"superscript",format:"superscript"},{title:"Subscript",icon:"subscript",format:"subscript"},{title:"Code",icon:"code",format:"code"}]},{title:"Blocks",items:[{title:"Paragraph",format:"p"},{title:"Blockquote",format:"blockquote"},{title:"Div",format:"div"},{title:"Pre",format:"pre"}]},{title:"Alignment",items:[{title:"Left",icon:"alignleft",format:"alignleft"},
{title:"Center",icon:"aligncenter",format:"aligncenter"},{title:"Right",icon:"alignright",format:"alignright"},{title:"Justify",icon:"alignjustify",format:"alignjustify"}]},{title:"Others",items:[{title:"Custom 1",selector:"p",classes:"custom-1"},{title:"Custom 2",selector:"p",classes:"custom-2"},{title:"Custom 3",selector:"p",classes:"custom-3"},{title:"Custom 4",selector:"p",classes:"custom-4"}]}]})})}catch(k){console.log("Init of TinyMCE failed. Error message was "+k)}})},initKenedoForm:function(b){a(b).find(".kenedo-details-form").each(function(){var b=
a(this).closest(".kenedo-details-form").data("record");e.setPropertyVisibility(null,b,a(this));a(this).on("kenedoFormDataChanged",e.setPropertyVisibility)})},initDatePickers:function(b){a(b).find(".datepicker").datepicker({dateFormat:"yy-mm-dd"});a(b).find(".kenedo-datepicker").each(function(){var b=a(this).closest(".kenedo-property").find(".form-control"),g=b.val();b={dateFormat:"yy-mm-dd",altFormat:"yy-mm-dd",altField:b};a(this).datepicker(b);g&&"0000-00-00"!==g&&a(this).datepicker("setDate",g)})},
initSortables:function(b){a(b).find(".sortable-listing tbody").sortable({handle:".sort-handle",items:"tr",axis:"y",scroll:!1,helper:function(b,g){g.children().each(function(){a(this).width(a(this).width())});return g},start:function(){var b=[],g=[],k=a(this).sortable("toArray"),f;for(f in k)!0===k.hasOwnProperty(f)&&(b.push(a("#"+k[f]+" .ordering-text-field").val()),g.push(k[f].replace("item-id-","")));a(this).data("currentOrdering",b);a(this).data("currentItemIds",g)},update:function(){a(this).closest(".kenedo-listing-form").find(".trigger-store-record-ordering").show();
var b=[],g=[],k=a(this).data("currentOrdering"),f=a(this).sortable("toArray"),c;for(c in f)!0===f.hasOwnProperty(c)&&(g.push(f[c].replace("item-id-","")),b.push(k[c]));for(var e in b)!0===b.hasOwnProperty(e)&&a(this).find("#item-id-"+g[e]+" .ordering-text-field").val(k[e]);k=b;a(this).data("currentOrdering",k);a(this).data("currentItemIds",g)}})},initRulePasteButtonVisibility:function(a){this.hasClipboardRule()?a.find(".rule-wrapper .trigger-paste-rule").show():a.find(".rule-wrapper .trigger-paste-rule").hide()},
hasClipboardRule:function(){return void 0!=this.getClipboardRule()},setClipboardRule:function(a){window.sessionStorage.setItem("clipboardRule",JSON.stringify(a))},getClipboardRule:function(){var a=window.sessionStorage.getItem("clipboardRule");if(void 0!==a)return JSON.parse(a)},initChosenDropdowns:function(b){0<a(b).find("select.listing-filter, select.join-select, .property-type-dropdown select, select.make-me-chosen, select.chosen-dropdown").length&&cbrequire(["cbj.chosen"],function(){a(b).find("select.listing-filter, select.join-select, .property-type-dropdown select, select.make-me-chosen, select.chosen-dropdown").chosen({disable_search_threshold:10,
search_contains:!0,inherit_select_classes:!0,width:"100%"});a(b).find(".chosen-container:hidden").each(function(){a(this).is(".join-select")?a(this).css("width","100%"):a(this).closest(".kenedo-properties").length?a(this).css("width","100%"):a(this).css("width","auto")})})},initGroupPriceFunctionality:function(){a(document).on("click",".property-type-groupPrice .trigger-show-group-picker",function(){var b=a(this).closest(".property-type-groupPrice");b.find(".group-picker").show();b.find(".trigger-show-group-picker").hide();
b.find(".trigger-cancel-group-picker").show()});a(document).on("click",".property-type-groupPrice .trigger-cancel-group-picker",function(){var b=a(this).closest(".property-type-groupPrice");b.find(".group-picker").hide();b.find(".trigger-show-group-picker").show();b.find(".trigger-cancel-group-picker").hide()});var b=function(b){var d=[];b.find(".price-overrides .price-override").each(function(){d.push({group_id:a(this).data("group-id"),price:a(this).find(".chosen-price").val()})});b.find(".overrides-json-data").val(window.JSON.stringify(d));
var c=d.length,f=b.find(".trigger-add-price-override").length;c>=f?b.find(".trigger-show-group-picker").addClass("hidden"):b.find(".trigger-show-group-picker").removeClass("hidden")};a(document).on("keyup change",".property-type-groupPrice .chosen-price",function(){var d=a(this).closest(".property-type-groupPrice");b(d)});a(document).on("click",".property-type-groupPrice .trigger-add-price-override",function(){var d=a(this).closest(".property-type-groupPrice"),g=a(this).data("group-id"),c=a(d).find(".price-override-blueprint .price-override").clone();
c.attr("data-group-id",g);c.find(".group-title-field").text(a(this).text());d.find(".price-overrides").append(c);a(this).addClass("used-already");d.find(".trigger-cancel-group-picker").trigger("click");b(d)});a(document).on("click",".property-type-groupPrice .trigger-remove-price-override",function(){var d=a(this).closest(".property-type-groupPrice"),g=a(this).closest(".price-override").data("group-id");a(this).closest(".price-override").remove();d.find(".group-picker .group-id-"+g).removeClass("used-already");
b(d)})},initCalculationOverrideFunctionality:function(){a(document).on("click",".property-type-calculationOverride .trigger-show-group-picker",function(){var b=a(this).closest(".property-type-calculationOverride");b.find(".group-picker").show();b.find(".trigger-show-group-picker").hide();b.find(".trigger-cancel-group-picker").show()});a(document).on("click",".property-type-calculationOverride .trigger-cancel-group-picker",function(){var b=a(this).closest(".property-type-calculationOverride");b.find(".group-picker").hide();
b.find(".trigger-show-group-picker").show();b.find(".trigger-cancel-group-picker").hide()});var b=function(b){var d=[];b.find(".price-overrides .price-override").each(function(){d.push({group_id:parseInt(a(this).data("group-id")),calculation_id:parseInt(a(this).find(".calculation-select").val())})});b.find(".overrides-json-data").val(window.JSON.stringify(d));var c=d.length,f=b.find(".trigger-add-price-override").length;c>=f?b.find(".trigger-show-group-picker").addClass("hidden"):b.find(".trigger-show-group-picker").removeClass("hidden")};
a(document).on("change",".property-type-calculationOverride .calculation-select",function(){var d=a(this).closest(".property-type-calculationOverride");b(d)});a(document).on("click",".property-type-calculationOverride .trigger-add-price-override",function(){var d=a(this).closest(".property-type-calculationOverride"),c=a(this).data("group-id"),e=a(d).find(".price-override-blueprint .price-override").clone();e.attr("data-group-id",c);e.find(".group-title-field").text(a(this).text());c="dummy-id-for-chosen-"+
Math.floor(1E4*Math.random());var f=e.find(".calculation-select");f.attr("id",c).attr("name",c);var h=e.find(".trigger-open-join-link-modal");h.attr("data-name-form-control",h.attr("data-name-form-control").replace("PLACEHOLDER_CALC_SELECT",c));d.find(".price-overrides").append(e);f.chosen({disable_search_threshold:10,search_contains:!0,inherit_select_classes:!0,width:"100%"});a(this).addClass("used-already");d.find(".trigger-cancel-group-picker").trigger("click");b(d)});a(document).on("click",".property-type-calculationOverride .trigger-remove-price-override",
function(){var d=a(this).closest(".property-type-calculationOverride"),c=a(this).closest(".price-override").data("group-id");a(this).closest(".price-override").remove();d.find(".group-picker .group-id-"+c).removeClass("used-already");b(d)})},initCalculationJoinLinks:function(){a(document).on("change",".kenedo-details-form .calculation-select",function(){var b=a(this),d=parseInt(b.val());b=b.closest(".select-and-links").find(".trigger-open-join-link-modal");b.data("selected-id",d);0===d?b.text(b.data("link-text-new")):
b.text(b.data("link-text-open"))});a(document).on("click",".trigger-open-join-link-modal",function(){var b=a(this);if(!b.hasClass("disabled")){b.addClass("disabled");var d=b.closest(".select-and-links"),c=b.closest(".kenedo-details-form"),e=a(".view-admin .configbox-modals"),f=e.children(".join-link-modal");if(0===f.length){f=d.find(".join-link-modal").appendTo(e);var l;f.on("show.bs.modal",function(){l=a(this).siblings(".modal:visible");l.modal("hide")});f.on("hidden.bs.modal",function(){l.modal("show");
l=a(".some-div-that-does-not-exists")})}b.data("request-data").id=b.data("selected-id");h.injectHtml(f.find(".modal-content"),b.data("controller"),b.data("task"),b.data("request-data"),function(){b.removeClass("disabled");f.modal({keyboard:!1});a("html, body").animate({scrollTop:0},100);f.find(".kenedo-details-form").on("cbFormTaskResponseReceived",function(d,e,f){if("store"===f.task||"apply"===f.task){try{var g=JSON.parse(e.responseText)}catch(n){console.warn('Could not parse JSON response. Exception message follows. ResponseText was: "'+
e.responseText+'"');console.warn(n);return}!0===g.success&&!0===g.wasInsert&&(c.find("select.calculation-select").each(function(){a(this).append('<option value="'+g.data.id+'">'+g.data.name+"</option>");a(this).trigger("chosen:updated")}),(d=b.data("name-form-control"))&&c.find("select[name="+d+"]").val(g.data.id).trigger("chosen:updated").trigger("change"))}})})}})},initRulePropertyFunctionality:function(){a(document).on("click",".trigger-delete-rule",function(){a(this).closest(".kenedo-property").find(".data-field").val("").trigger("change");
a(this).closest(".kenedo-property").find(".rule-wrapper").removeClass("has-rule").addClass("has-no-rule")});a(document).on("click",".trigger-copy-rule",function(){var b=a(this).closest(".rule-wrapper");b={productId:b.find(".data-field").data("product-id"),ruleJson:b.find(".data-field").val(),ruleHtml:b.find(".rule-html").html()};c.setClipboardRule(b);a(".trigger-paste-rule").show()});a(document).on("click",".trigger-paste-rule",function(){if(!1!==c.hasClipboardRule()){var b=c.getClipboardRule(),d=
a(this).closest(".rule-wrapper"),e=d.find(".data-field").data("product-id");parseInt(b.productId)!==parseInt(e)?window.alert("Rule in clipboard is for another product"):(d.find(".data-field").val(b.ruleJson),d.find(".rule-html").html(b.ruleHtml),d.removeClass("has-no-rule").addClass("has-rule"))}});a(document).on("click",".trigger-edit-rule",function(){var b=a(this),d=b.closest(".kenedo-property").find(".data-field"),c=d.data("editor-url"),e=a(".view-admin .configbox-modals"),f=e.children(".rule-editor-modal");
if(0===f.length){f=b.closest(".kenedo-property").find(".rule-editor-modal").appendTo(e);var h;f.on("show.bs.modal",function(){h=a(this).siblings(".modal:visible");h.modal("hide")});f.on("hidden.bs.modal",function(){h.modal("show");h=a(".asdfsadfsadf")})}var m={usageIn:d.data("usage-in"),productId:d.data("product-id"),pageId:d.data("page-id"),rule:d.val()};f.find(".modal-content").html("");f.one("show.bs.modal",function(){f.find(".modal-content").load(c,m,function(){f.data("form-property",b.closest(".kenedo-property"));
a(document).trigger("cbViewInjected")})});f.modal()})},registerLegacyReadyFunctions:function(){e.registerSubviewReadyFunction("view-adminelement",function(){0!==a(".view-adminelement .not-using-shapediver").length&&a(".property-group-shapediver_start").addClass("hidden")});e.registerSubviewReadyFunction("view-adminoptionassignment",function(){0!==a(".view-adminoptionassignment .not-using-shapediver").length&&a(".property-group-shapediver_start").addClass("hidden")});e.registerSubviewReadyFunction("view-adminmainmenu",
function(){a(document).on("click",".view-adminmainmenu .trigger-toggle-sub-items",function(){a(this).toggleClass("opened");a(this).closest(".menu-list-item").children(".sub-items").toggleClass("opened")})});e.registerSubviewReadyFunction("view-admintemplate",function(){cbrequire(["configbox/server"],function(a){e.addStylesheet(a.config.urlSystemAssets+"/kenedo/external/codemirror-5.30.0/lib/codemirror.css?version="+a.config.cacheVar)});cbrequire(["codemirror","codemirror/mode/htmlmixed/htmlmixed",
"codemirror/mode/php/php","codemirror/mode/javascript/javascript"],function(b){b.fromTextArea(document.getElementById("template-code"),{lineNumbers:!0,matchBrackets:!0,mode:"php",indentUnit:4,indentWithTabs:!0,viewportMargin:Infinity}).on("change",function(b){a("#template-code").val(b.getValue())})})})},runLegacyReadyFunctions:function(a){var b=a.data("view-id");(a=b?"view-"+b:a.find(".kenedo-view").eq(0).attr("id"))&&e.runSubviewReadyFunctions(a)}};return{initBackendOnce:function(){c.registerLegacyReadyFunctions();
c.initOffCanvasToggle();c.initRulePropertyFunctionality();c.initGroupPriceFunctionality();c.initCalculationOverrideFunctionality();c.initCalculationJoinLinks();e.initAdminPageOnce()},initBackendEach:function(a){c.initKenedoForm(a);c.initChosenDropdowns(a);c.initHtmlEditors(a);c.initDatePickers(a);c.initSortables(a);c.initRulePasteButtonVisibility(a);c.runLegacyReadyFunctions(a);e.initAdminPageEach(a)}}});
