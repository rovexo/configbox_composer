define("cbj kenedo configbox/server cbj.ui configbox/ruleEditor configbox/calcEditor".split(" "),function(a,d,k){return{initBackend:function(){a("body").on("click",".view-item-picker .sub-list-trigger",function(){a(this).is(".trigger-opened")?(a(this).removeClass("trigger-opened"),a(this).closest("li").children(".sub-list").removeClass("list-opened")):(a(this).addClass("trigger-opened"),a(this).closest("li").children(".sub-list").addClass("list-opened"))});a(document).on("click",".trigger-toggle-offcanvas",
function(){a(".row-offcanvas").toggleClass("active");a(this).toggleClass("fa-bars").toggleClass("fa-window-close")});a(".toggle-wrapper").on("click",".toggle-handle",function(){a(this).closest(".toggle-wrapper").find(".toggle-content").toggle();a(this).toggleClass("opened")});var n=a(".left-part").outerHeight();a(".news").outerHeight(n);a(".configbox-mainmenu").css("min-height",parseInt(n)-27);a(document).on("click",".trigger-store-license-key",function(){a(this).closest("form").submit()});d.registerSubviewReadyFunction("view-adminelement",
function(){0!==a("#view-adminelement .not-using-shapediver").length&&a(".property-group-shapediver_start").addClass("hidden")});d.registerSubviewReadyFunction("view-adminoptionassignment",function(){0!==a("#view-adminoptionassignment .not-using-shapediver").length&&a(".property-group-shapediver_start").addClass("hidden")});d.registerSubviewReadyFunction("view-adminmainmenu",function(){a(document).on("click","#view-adminmainmenu .trigger-toggle-sub-items",function(){a(this).toggleClass("opened");a(this).closest(".menu-list-item").children(".sub-items").toggleClass("opened")})});
d.registerSubviewReadyFunction("view-admincalculation",function(){a(document).on("click","#view-admincalculation .task-copy",function(c){c.stopPropagation();a("#id").val("");a("#task").val("apply");a(".task-apply").click()});a("#view-admincalculation #property-name-product_id select").change(function(){a(this).val()&&(a("#view-admincalculation #property-name-type").show(),a("#view-admincalculation #property-name-type input:checked").change())});a("#view-admincalculation #property-name-type input").change(function(){var c=
a(this).val(),c=a(".calc-type-subview").data("url-"+c),b=a("#view-admincalculation #property-name-product_id #product_id").val(),c="magento"===k.config.platformName?c+("productId/"+b):c+(-1===c.indexOf("?")?"?productId="+b:"&productId="+b);d.loadSubview(c,".calc-type-subview",null,!1)})});d.registerSubviewReadyFunction("view-admincalccode",function(){a("#view-admincalccode select option").each(function(){if(0!=a(this).attr("value")){var c=a(this).text()+" (ID: "+a(this).attr("value")+")";a(this).text(c)}});
cbrequire(["cbj.chosen"],function(){a("#view-admincalccode select").chosen()})});d.registerSubviewReadyFunction("view-adminorders",function(){0!==a(".in-frontend").length&&a(".listing-link").click(function(c){c.stopPropagation();window.location.href=a(this).attr("href")});a("#view-adminorders .kenedo-limit-select").attr("name","limit");a("#view-adminorders .kenedo-limit-select").change(function(){a(this).closest("form").submit()});a("#view-adminorders .kenedo-pagination-list a").click(function(){var c=
a(this).attr("class").replace("page-start-","");a("#start").val(c);a(this).closest("form").submit()});a("#view-adminorders .kenedo-filter-list select").change(function(){a(this).closest("form").submit()});a("#view-adminorders .kenedo-task-list li.task").click(function(){var c=a(this).attr("class").replace("task-","").replace("task","").replace(" ","");a("#task").val(c);a(this).closest("form").submit()})});d.registerSubviewReadyFunction("view-adminusers",function(){a("#view-adminusers .kenedo-listing-form .order-property").on("click",
function(){var c=a(this).attr("id").replace("order-property-",""),b="asc";a(this).hasClass("active")&&(b=a(this).hasClass("direction-asc")?"desc":"asc");a("#order_field").val(c);a("#order_dir").val(b);a(this).closest("form").submit()});a("#view-adminusers .kenedo-limit-select").attr("name","limit");a("#view-adminusers .kenedo-limit-select").change(function(){a(this).closest("form").submit()});a("#view-adminusers .kenedo-pagination-list a").click(function(){var c=a(this).attr("class").replace("page-start-",
"");a("#start").val(c);a(this).closest("form").submit()});a("#view-adminusers .kenedo-filter-list select").change(function(){a(this).closest("form").submit()})});d.registerSubviewReadyFunction("view-adminuser",function(){a(".kenedo-details-form").addClass("no-validation")});d.registerSubviewReadyFunction("view-admintemplate",function(){cbrequire(["configbox/server"],function(a){d.addStylesheet(a.config.urlSystemAssets+"/kenedo/external/codemirror-5.30.0/lib/codemirror.css?version="+a.config.cacheVar)});
cbrequire(["codemirror","codemirror/mode/htmlmixed/htmlmixed","codemirror/mode/php/php","codemirror/mode/javascript/javascript"],function(c){c.fromTextArea(document.getElementById("template-code"),{lineNumbers:!0,matchBrackets:!0,mode:"php",indentUnit:4,indentWithTabs:!0,viewportMargin:Infinity}).on("change",function(b){a("#template-code").val(b.getValue())})})});d.registerSubviewReadyFunction("view-adminoptionassignment",function(){console.log("loaded");a(document).on("change","#view-adminoptionassignment #option_id",
function(){var c=a(this).val(),b=a("#option_assignment_load_url").val(),f=b.replace("placeholder_option_id",c);console.log(b);console.log(f);console.log(c);cbrequire(["tinyMCE"],function(a){3<a.majorVersion&&a.remove()});a(".option-data .option-fields-target").animate({opacity:".0"},200,function(){a(".option-data .option-fields-target").load(f+" .kenedo-properties",function(){d.initNewContent(a(".option-data .option-fields-target"));d.afterInitNewContent(a(".option-data .option-fields-target"));a(".option-data .option-fields-target").animate({opacity:"1"},
400)})})})});d.registerSubviewReadyFunction("view-adminuserfields",function(){a(".browser-validation input, .server-validation input").each(function(){a(this).data("invalidEntry",!1)});a(".server-validation input").focus(function(){a(this).data("invalidEntry",null)});a(".server-validation input").change(function(){var c=a(this).val(),b=a(this);c||(b.css("border","1px solid #ccc"),b.data("invalidEntry",!1));if(c){b.parent().find(".loading-symbol").show();var f=k.config.urlXhr,e={option:"com_configbox"};
e.expression=c;e.controller="ajaxapi";e.view="ajaxapi";e.task="validateRegex";e.format="raw";e.tmpl="component";e.lang=k.config.languageCode;c={};c.data=e;c.async=!0;c.success=function(c){c=a.trim(c);"OK"!==c?(b.css("border","1px solid red"),window.alert(c),b.data("invalidEntry",!0)):(b.css("border","1px solid #ccc"),b.data("invalidEntry",!1));b.parent().find(".loading-symbol").hide()};a.ajax(f,c)}});a(".browser-validation input").change(function(){var c=a(this).val(),b=a(this);b.data("invalidEntry",
null);b.css("border","1px solid #ccc");try{(new RegExp(c)).exec("dummytext")}catch(f){b.css("border","1px solid red"),window.alert(f.message),b.data("invalidEntry",!0)}});a.each("salutation_id country email language billingsalutation_id billingcountry billingemail billinglanguage".split(" "),function(c,b){a(".userfield-"+b+" .browser-validation input, .userfield-"+b+" .server-validation input").prop("disabled",!0)});a.each("salutation_id firstname lastname country email billingsalutation_id billingfirstname billinglastname billingcountry billingemail".split(" "),
function(c,b){a(".userfield-"+b+" .show-checkout input").click(function(b){a(this).prop("checked")||(b.stopPropagation(),b.preventDefault(),window.alert("This field is needed by the system and cannot be hidden"))})});a.each("salutation_id firstname lastname country email billingsalutation_id billingfirstname billinglastname billingcountry billingemail".split(" "),function(c,b){a(".userfield-"+b+" .require-checkout input").click(function(b){a(this).prop("checked")||(b.stopPropagation(),b.preventDefault(),
window.alert("This field is needed by the system and cannot be made optional"))})});a.each(["billingsalutation_id","billingfirstname","billinglastname","billingcountry","billingemail"],function(c,b){a(".userfield-"+b+" .show-quotation input").click(function(b){a(this).prop("checked")||(b.stopPropagation(),b.preventDefault(),window.alert("This field is needed by the system and cannot be hidden"))})});a.each(["billingsalutation_id","billingfirstname","billinglastname","billingcountry","billingemail"],
function(c,b){a(".userfield-"+b+" .require-quotation input").click(function(b){a(this).prop("checked")||(b.stopPropagation(),b.preventDefault(),window.alert("This field is needed by the system and cannot be made optional"))})})});d.registerSubviewReadyFunction("view-adminproduct",function(){a(document).on("click",".trigger-load-model-data",function(){var c=a(this);if(!c.hasClass("processing")){c.addClass("processing");c.css("width",c.css("width"));c.data("ready-text",c.text());c.text(c.data("processing-text"));
var b=a(this).closest(".property-type-shapedivermodel"),f=b.find(".model-url"),e=b.find(".model-parameters"),d=b.find(".model-textured-geometries"),l=b.find(".shapediver-iframe"),g=f.val();cbrequire(["configbox/shapediver"],function(b){if("http"!==g.substr(0,4)){var h=/<iframe.*?src="(.*?)"/,m=h.exec(g);m&&"undefined"!==typeof m[1]?g=h.exec(g)[1]:(h=/<iframe.*?src='(.*?)'/,(m=h.exec(g))&&"undefined"!==typeof m[1]&&(g=h.exec(g)[1]))}h=g.indexOf("?");-1!==h&&(g=g.substr(0,h));f.val(g).change();b.addMessageListener();
var k={doneJobs:[],requiredJobs:["getParameters","getTextures"],registerDoneJob:function(a){this.doneJobs.push(a);a=!1;for(var b in this.requiredJobs)this.requiredJobs.hasOwnProperty(b)&&-1===this.doneJobs.indexOf(this.requiredJobs[b])&&(a=!0);!1===a&&this.doneCallback()},doneCallback:function(){c.text(c.data("done-text"));c.addClass("btn-success");window.setTimeout(function(){c.text(c.data("ready-text"));c.removeClass("btn-success");c.removeClass("processing")},1E3)}};l.on("load",function(){b.sendMessage({command:"getParameterDefinitions",
arguments:[]},"shapediver-iframe",function(a){var b=[];0!==a.errorCode?window.alert("Cannot get parameter definitions from model. Error code is "+a.errorCode+" Error message is "+a.errorMessage+". Assuming that there are no parameters in model."):b=a.result;for(var c in b)!0===b.hasOwnProperty(c)&&"undefined"===typeof b[c].type&&"undefined"!==typeof b[c].choices&&(b[c].type="choices");e.val(JSON.stringify(b)).change();k.registerDoneJob("getParameters")});a(document).on("sdGeometryUpdateDone",function(){b.sendMessage({command:"findTexturedGeometry",
arguments:[]},"shapediver-iframe",function(a){var b=[];0!==a.errorCode?window.alert("Cannot get texturedGeometries from model. Error code is "+a.errorCode+" Error message is "+a.errorMessage+". Assuming that there are no textures in model."):b=a.result;d.val(JSON.stringify(b)).change();k.registerDoneJob("getTextures")})})});g+="?version="+l.data("api-version");g!==l.attr("src")&&l.attr("src","about:blank");l.attr("src",g)})}});a(document).on("change",".model-parameters, .model-textured-geometries, .model-url, .model-ratio",
function(){var c=a(this).closest(".property-type-shapedivermodel"),b=c.find(".model-url"),f=c.find(".model-parameters"),e=c.find(".model-textured-geometries"),d=c.find(".model-ratio"),c=c.find(".shapediver-model-data"),b={iframeUrl:b.val(),ratioDimensions:d.val(),parameterData:JSON.parse(f.val()),texturedGeometries:JSON.parse(e.val())};c.val(JSON.stringify(b))});a(document).on("keyup",".model-ratio",function(){a(this).trigger("change")})});a(document).on("click",".trigger-delete-rule",function(){a(this).closest(".kenedo-property").find(".data-field").val("").trigger("change");
a(this).closest(".kenedo-property").find(".rule-wrapper").removeClass("has-rule").addClass("has-no-rule")});a(document).on("click",".trigger-edit-rule",function(){var c=a(this).closest(".kenedo-property").find(".data-field"),b=a(this).closest(".kenedo-property").find(".modal");cbrequire(["cbj.bootstrap"],function(){var f=c.data("editor-url"),e={returnFieldId:c.data("return-field-id"),usageIn:c.data("usage-in"),productId:c.data("product-id"),pageId:c.data("page-id"),rule:c.val()};b.find(".modal-content").html("");
b.one("show.bs.modal",function(){b.find(".modal-content").load(f,e,function(){a(document).trigger("cbViewInjected")})});b.modal()})});(function(){a(document).on("click",".property-type-groupPrice .trigger-show-group-picker",function(){var b=a(this).closest(".property-type-groupPrice");b.find(".group-picker").show();b.find(".trigger-show-group-picker").hide();b.find(".trigger-cancel-group-picker").show()});a(document).on("click",".property-type-groupPrice .trigger-cancel-group-picker",function(){var b=
a(this).closest(".property-type-groupPrice");b.find(".group-picker").hide();b.find(".trigger-show-group-picker").show();b.find(".trigger-cancel-group-picker").hide()});var c=function(b){var c=[];b.find(".price-overrides .price-override").each(function(){c.push({group_id:a(this).data("group-id"),price:a(this).find(".chosen-price").val()})});b.find(".overrides-json-data").val(window.JSON.stringify(c));var e=c.length,d=b.find(".trigger-add-price-override").length;e>=d?b.find(".trigger-show-group-picker").addClass("hidden"):
b.find(".trigger-show-group-picker").removeClass("hidden")};a(document).on("keyup change",".property-type-groupPrice .chosen-price",function(){var b=a(this).closest(".property-type-groupPrice");c(b)});a(document).on("click",".property-type-groupPrice .trigger-add-price-override",function(){var b=a(this).closest(".property-type-groupPrice"),f=a(this).data("group-id"),e=a(b).find(".price-override-blueprint .price-override").clone();e.attr("data-group-id",f);e.find(".group-title-field").text(a(this).text());
b.find(".price-overrides").append(e);a(this).addClass("used-already");b.find(".trigger-cancel-group-picker").trigger("click");c(b)});a(document).on("click",".property-type-groupPrice .trigger-remove-price-override",function(){var b=a(this).closest(".property-type-groupPrice"),f=a(this).closest(".price-override").data("group-id");a(this).closest(".price-override").remove();b.find(".group-picker .group-id-"+f).removeClass("used-already");c(b)})})();(function(){a(document).on("click",".property-type-calculationOverride .trigger-show-group-picker",
function(){var b=a(this).closest(".property-type-calculationOverride");b.find(".group-picker").show();b.find(".trigger-show-group-picker").hide();b.find(".trigger-cancel-group-picker").show()});a(document).on("click",".property-type-calculationOverride .trigger-cancel-group-picker",function(){var b=a(this).closest(".property-type-calculationOverride");b.find(".group-picker").hide();b.find(".trigger-show-group-picker").show();b.find(".trigger-cancel-group-picker").hide()});var c=function(b){var c=
[];b.find(".price-overrides .price-override").each(function(){c.push({group_id:parseInt(a(this).data("group-id")),calculation_id:parseInt(a(this).find(".chosen-calculation").val())})});b.find(".overrides-json-data").val(window.JSON.stringify(c));var e=c.length,d=b.find(".trigger-add-price-override").length;e>=d?b.find(".trigger-show-group-picker").addClass("hidden"):b.find(".trigger-show-group-picker").removeClass("hidden")};a(document).on("change",".property-type-calculationOverride .chosen-calculation",
function(){var b=a(this).closest(".property-type-calculationOverride");c(b);b=a(this).val();a(this).closest(".price-override").find(".join-link-"+b).show().siblings().hide()});a(document).on("click",".property-type-calculationOverride .trigger-add-price-override",function(){var b=a(this).closest(".property-type-calculationOverride"),f=a(this).data("group-id"),e=a(b).find(".price-override-blueprint .price-override").clone();e.attr("data-group-id",f);e.find(".group-title-field").text(a(this).text());
f="dummy-id-for-chosen-"+Math.floor(1E4*Math.random());e.find("select").attr("id",f).attr("name",f);var d=e.find(".join-link-0 a").attr("href");d&&(d=d.replace("PLACEHOLDER_CALC_SELECT",f),e.find(".join-link-0 a").attr("href",d));b.find(".price-overrides").append(e);a("#"+f).chosen({disable_search_threshold:10,search_contains:!0,inherit_select_classes:!0,width:"100%"});a(this).addClass("used-already");b.find(".trigger-cancel-group-picker").trigger("click");c(b)});a(document).on("click",".property-type-calculationOverride .trigger-remove-price-override",
function(){var b=a(this).closest(".property-type-calculationOverride"),d=a(this).closest(".price-override").data("group-id");a(this).closest(".price-override").remove();b.find(".group-picker .group-id-"+d).removeClass("used-already");c(b)})})();d.initAdminPage()}}});
