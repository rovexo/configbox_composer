var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.findInternal=function(a,f,e){a instanceof String&&(a=String(a));for(var d=a.length,b=0;b<d;b++){var c=a[b];if(f.call(e,c,b,a))return{i:b,v:c}}return{i:-1,v:void 0}};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.SIMPLE_FROUND_POLYFILL=!1;$jscomp.ISOLATE_POLYFILLS=!1;$jscomp.FORCE_POLYFILL_PROMISE=!1;$jscomp.FORCE_POLYFILL_PROMISE_WHEN_NO_UNHANDLED_REJECTION=!1;
$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(a,f,e){if(a==Array.prototype||a==Object.prototype)return a;a[f]=e.value;return a};$jscomp.getGlobal=function(a){a=["object"==typeof globalThis&&globalThis,a,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof global&&global];for(var f=0;f<a.length;++f){var e=a[f];if(e&&e.Math==Math)return e}throw Error("Cannot find global object");};$jscomp.global=$jscomp.getGlobal(this);
$jscomp.IS_SYMBOL_NATIVE="function"===typeof Symbol&&"symbol"===typeof Symbol("x");$jscomp.TRUST_ES6_POLYFILLS=!$jscomp.ISOLATE_POLYFILLS||$jscomp.IS_SYMBOL_NATIVE;$jscomp.polyfills={};$jscomp.propertyToPolyfillSymbol={};$jscomp.POLYFILL_PREFIX="$jscp$";var $jscomp$lookupPolyfilledValue=function(a,f){var e=$jscomp.propertyToPolyfillSymbol[f];if(null==e)return a[f];e=a[e];return void 0!==e?e:a[f]};
$jscomp.polyfill=function(a,f,e,d){f&&($jscomp.ISOLATE_POLYFILLS?$jscomp.polyfillIsolated(a,f,e,d):$jscomp.polyfillUnisolated(a,f,e,d))};$jscomp.polyfillUnisolated=function(a,f,e,d){e=$jscomp.global;a=a.split(".");for(d=0;d<a.length-1;d++){var b=a[d];if(!(b in e))return;e=e[b]}a=a[a.length-1];d=e[a];f=f(d);f!=d&&null!=f&&$jscomp.defineProperty(e,a,{configurable:!0,writable:!0,value:f})};
$jscomp.polyfillIsolated=function(a,f,e,d){var b=a.split(".");a=1===b.length;d=b[0];d=!a&&d in $jscomp.polyfills?$jscomp.polyfills:$jscomp.global;for(var c=0;c<b.length-1;c++){var g=b[c];if(!(g in d))return;d=d[g]}b=b[b.length-1];e=$jscomp.IS_SYMBOL_NATIVE&&"es6"===e?d[b]:null;f=f(e);null!=f&&(a?$jscomp.defineProperty($jscomp.polyfills,b,{configurable:!0,writable:!0,value:f}):f!==e&&(void 0===$jscomp.propertyToPolyfillSymbol[b]&&($jscomp.propertyToPolyfillSymbol[b]=$jscomp.IS_SYMBOL_NATIVE?$jscomp.global.Symbol(b):
$jscomp.POLYFILL_PREFIX+b),$jscomp.defineProperty(d,$jscomp.propertyToPolyfillSymbol[b],{configurable:!0,writable:!0,value:f})))};$jscomp.polyfill("Array.prototype.find",function(a){return a?a:function(f,e){return $jscomp.findInternal(this,f,e).v}},"es6","es3");
define(["cbj","kenedo","configbox/server"],function(a,f,e){var d={initRuleEditor:function(){a.fn.makeDropZone=function(b){if("undefined"!==typeof b)var c=b;this.droppable({hoverClass:"drag-over",tolerance:"pointer",drop:function(g,h){g=a(h.helper).clone(!0,!0).removeClass("ui-draggable ui-draggable-dragging").removeAttr("style");"undefined"!==typeof c&&c.closest(".rule-area").length&&(a(h.draggable).draggable("option","revertDuration",0),c.remove());g.makeDraggableItem();a(this).replaceWith(g)}})};
a.fn.makeDraggableItem=function(){this.draggable({addClasses:!1,revert:!0,helper:"clone",opacity:.8,start:function(){a(this).closest(".rule-area").length&&a(this).hide();var b=a(this).closest(".view-adminruleeditor").find(".rule-area");b.find(".drop-area:not(.initial)").remove();a(this).draggable("option","revertDuration",100);if(0===b.find(".drop-area").length){if(0===b.find(".item").length)b.html('<span class="drop-area">&nbsp;</span>');else{var c="",g="";if(a(this).is(".condition")||a(this).is(".bracket"))c=
".combinator:first-child",g=".combinator";a(this).is(".combinator")&&(c=".condition + .condition, .bracket + .bracket, .condition + .bracket, .condition:first-child, .bracket:first-child",g=".condition:last-child, .bracket:last-child");if(!c||!g)throw"Could not figure out dropzone selectors.";b.find(c).before('<span class="drop-area">&nbsp;</span>');b.find(g).after('<span class="drop-area">&nbsp;</span>');b.find(".bracket:empty").html('<span class="drop-area">&nbsp;</span>')}0!==a(this).closest(".rule-area").length&&
a(this).after('<span class="drop-area">&nbsp;</span>');b.find(".drop-area, .parameter-drop-area").makeDropZone(a(this))}},stop:function(){var b=a(this).closest(".view-adminruleeditor").find(".rule-area");0!==b.find(".item").length&&b.find(".drop-area").remove();a(this).show()}});return this};a(".view-adminruleeditor .rule-area .item").makeDraggableItem();a(".view-adminruleeditor #combinator-blueprints .item").makeDraggableItem();a(".view-adminruleeditor .selected-panel .item").makeDraggableItem();
a(".view-adminruleeditor").on("panelSelected",function(){a(".view-adminruleeditor .selected-panel .item").makeDraggableItem()});a(".view-adminruleeditor .drop-area").makeDropZone();a(".view-adminruleeditor .rule-area").on("click",".item",function(b){b.shiftKey||a(this).closest(".rule-area").find(".selected").removeClass("selected");a(b.target).is(".input")||(a(b.target).is(".item")?a(b.target).addClass("selected"):0!==a(b.target).closest(".item").length&&a(b.target).closest(".item").addClass("selected"))});
a(".view-adminruleeditor").on("click",function(b){!1===a(b.target).is(".item")&&0===a(b.target).closest(".item").length&&a(this).closest(".view-adminruleeditor").find(".rule-area .selected").removeClass("selected")});a(".view-adminruleeditor").on("click",".button-limit-condition-width",function(){a(this).closest(".view-adminruleeditor").find(".rule-area").toggleClass("squeeze")});a(".view-adminruleeditor").on("click",".button-remove-selected-items",d.removeSelectedItems);a(".view-adminruleeditor").on("click",
".button-put-in-brackets",d.putInBrackets);a(document).keyup(function(b){switch(b.which){case 46:d.removeSelectedItems.apply(this,arguments)}b.preventDefault()});a(".view-adminruleeditor").on("click",".button-store",d.storeRule);a(".view-adminruleeditor").on("click",".button-cancel",function(){a(this).closest(".modal").modal("hide").find(".modal-content").html("")});a(".view-adminruleeditor").on("click",".picker-tab",function(){var b=a(this).closest(".view-adminruleeditor"),c=a(this).attr("id");a(this).addClass("selected-tab").siblings().removeClass("selected-tab");
b.find(".picker-panels ."+c).addClass("selected-panel").siblings().removeClass("selected-panel");b.trigger("panelSelected",[c])});a(".view-adminruleeditor .condition input[type=text]").each(d.adjustTextFieldWidth);a(".view-adminruleeditor").on("keyup change click",".condition input[type=text]",d.adjustTextFieldWidth);a(".view-adminruleeditor").on("click",".condition-operator",function(){a(".condition .operator-picker").remove();("selectedOption.id"===a(this).closest(".condition").data("field")?a("#operator-picker-blueprint .operator-picker-short"):
a("#operator-picker-blueprint .operator-picker-full")).clone().appendTo(a(this))});a(".view-adminruleeditor").on("click",function(b){a(b.target).is(".condition-operator")||a(".condition .operator-picker").remove()});a(".view-adminruleeditor").on("click",".rule-area .operator, #condition-picker .operator",function(){var b=a(this).data("operator");a(this).closest(".condition").data("operator",b).attr("data-operator",b);a(this).closest(".condition-operator").text(a(this).text()+" ")});a(".view-adminruleeditor").on("change",
".page-filter select",function(){var b=parseInt(a(this).val());a(".question-picker li").removeClass("shown").removeClass("selected");a(0===b?".question-picker .question-list li":".question-picker .question-list li.page-"+b).addClass("shown");a("#question-filter").val("");a(".question-picker li.hidden-by-question-filter").removeClass("hidden-by-question-filter")});a("#question-filter").keyup(function(){var b=a(this).val();b=b.trim();b=b.toLowerCase();""===b&&a(".question-picker li").removeClass("hidden-by-question-filter");
a(".question-picker li.shown").each(function(){var c=a(this).text();c=c.trim();c=c.toLowerCase();-1===c.indexOf(b)?a(this).addClass("hidden-by-question-filter"):a(this).removeClass("hidden-by-question-filter")})});a(".view-adminruleeditor").on("click",".question-list li",function(){var b=a(this).data("question-id");a("#answer-group-"+b).show().siblings().hide();a("#question-attributes #answer-group-"+b+" .item").makeDraggableItem();a(this).addClass("picked").siblings().removeClass("picked");a("#question-attributes").show()})},
storeRule:function(){var b=a(this).closest(".view-adminruleeditor");b.find(".rule-area .drop-area").remove();var c=b.closest(".rule-editor-modal").data("form-property"),g="",h=d.getRuleItems(b.find(".rule-area")),l="1"===b.find(".rule-is-negated").val();if(!0===l&&0<h.length){var k=b.find(".rule-is-negated option[value=1]").data("prefix-rule-text");h.unshift({type:"negation"})}else k=b.find(".rule-is-negated option[value=0]").data("prefix-rule-text");h.length&&(g=JSON.stringify(h).replace(/^"/g,"").replace(/"$/g,
""));c.find(".data-field").val(g).trigger("change");b.find(".rule-area input").each(function(){a(this).replaceWith('<span class="condition-value">'+a(this).val()+"</span>")});h="";l&&(h+=k+" ");h+=b.find(".rule-area").html();b=c.find(".rule-html");b.html(h);g?b.closest(".rule-wrapper").addClass("has-rule").removeClass("has-no-rule"):b.closest(".rule-wrapper").removeClass("has-rule").addClass("has-no-rule");a(this).closest(".modal").modal("hide").find(".modal-content").html("")},getRuleItems:function(b){var c=
[];b=b.children(".item");for(var g in b)if(!0===b.hasOwnProperty(g)&&!0!==isNaN(parseInt(g))){var h=d.getItemMetadata(a(b[g]));switch(h.type){case "bracket":c[g]=d.getRuleItems(a(b[g]));break;case "function":var l=a(b[g]).find(".parameter");h.parameters=[];for(var k in l)if(l.hasOwnProperty(k)&&!0!==isNaN(parseInt(g))){var m=d.getRuleItems(a(l[k]));h.parameters.push(m)}c[g]=h;break;default:c[g]=h}}return c},getItemMetadata:function(b){var c=a(b).data(),g={},h;for(h in c)c.hasOwnProperty(h)&&"uiDraggable"!==
h&&(g[h]=c[h]);a(b).find(".input").each(function(){var l=a(this).data("data-key");if(l){var k=a(this).val();if(""!==k){var m=k.replace(e.config.decimalSymbol,".");m=Number(m);!1===isNaN(m)&&(k=m)}g[l]=k}});return g},putInBrackets:function(){var b=a(this).closest(".view-adminruleeditor"),c=Math.ceil(2E4*Math.random());b.find(".selected").wrapAll('<span class="item bracket" data-type="bracket" id="bracket-'+c+'" />');a("#bracket-"+c).makeDraggableItem().removeAttr("id");b.find(".rule-area .selected").removeClass("selected")},
removeSelectedItems:function(){var b=a(this).closest(".view-adminruleeditor");b.find(".selected").each(function(){a(this).is(".bracket")&&a(this).children().detach().clone(!0,!0).insertAfter(a(this));a(this).next(".combinator").remove();a(this).is(":last-child")&&a(this).prev(".combinator").remove();a(this).remove()});b.find(".rule-editor .parameter").each(function(){var c=a(this);if(0===c.find(".item").length){var g='<span class="parameter-drop-area">'+c.data("parameter-name")+"</span>";c.html(g)}})},
adjustTextFieldWidth:function(){var b=""===a(this).val()?a(this).attr("placeholder"):a(this).val();a("#width-tester").text(b);a("#width-tester").css("font-size",a(this).css("font-size"));a("#width-tester").css("font-family",a(this).css("font-family"));b=parseInt(a("#width-tester").css("width"));10>b&&(b=10);b+=10;a(this).css("width",b+"px")}};return d});
