var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.findInternal=function(a,g,d){a instanceof String&&(a=String(a));for(var h=a.length,b=0;b<h;b++){var c=a[b];if(g.call(d,c,b,a))return{i:b,v:c}}return{i:-1,v:void 0}};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.SIMPLE_FROUND_POLYFILL=!1;
$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(a,g,d){a!=Array.prototype&&a!=Object.prototype&&(a[g]=d.value)};$jscomp.getGlobal=function(a){a=["object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof global&&global,a];for(var g=0;g<a.length;++g){var d=a[g];if(d&&d.Math==Math)return d}return globalThis};$jscomp.global=$jscomp.getGlobal(this);
$jscomp.polyfill=function(a,g,d,h){if(g){d=$jscomp.global;a=a.split(".");for(h=0;h<a.length-1;h++){var b=a[h];b in d||(d[b]={});d=d[b]}a=a[a.length-1];h=d[a];g=g(h);g!=h&&null!=g&&$jscomp.defineProperty(d,a,{configurable:!0,writable:!0,value:g})}};$jscomp.polyfill("Array.prototype.find",function(a){return a?a:function(a,d){return $jscomp.findInternal(this,a,d).v}},"es6","es3");
define(["cbj","kenedo","configbox/server"],function(a,g,d){var h={initRuleEditor:function(){a.fn.makeDropZone=function(b){if("undefined"!==typeof b)var c=b;this.droppable({hoverClass:"drag-over",tolerance:"pointer",drop:function(b,e){b=a(e.helper).clone(!0,!0).removeClass("ui-draggable ui-draggable-dragging").removeAttr("style");"undefined"!==typeof c&&c.closest(".rule-area").length&&(a(e.draggable).draggable("option","revertDuration",0),c.remove());b.makeDraggableItem();a(this).replaceWith(b)}})};
a.fn.makeDraggableItem=function(){this.draggable({addClasses:!1,revert:!0,helper:"clone",opacity:.8,start:function(){a(this).closest(".rule-area").length&&a(this).hide();var b=a(this).closest(".view-adminruleeditor").find(".rule-area");b.find(".drop-area:not(.initial)").remove();a(this).draggable("option","revertDuration",100);if(0===b.find(".drop-area").length){if(0===b.find(".item").length)b.html('<span class="drop-area">&nbsp;</span>');else{var c="",f="";if(a(this).is(".condition")||a(this).is(".bracket"))c=
".combinator:first-child",f=".combinator";a(this).is(".combinator")&&(c=".condition + .condition, .bracket + .bracket, .condition + .bracket, .condition:first-child, .bracket:first-child",f=".condition:last-child, .bracket:last-child");if(!c||!f)throw"Could not figure out dropzone selectors.";b.find(c).before('<span class="drop-area">&nbsp;</span>');b.find(f).after('<span class="drop-area">&nbsp;</span>');b.find(".bracket:empty").html('<span class="drop-area">&nbsp;</span>')}0!==a(this).closest(".rule-area").length&&
a(this).after('<span class="drop-area">&nbsp;</span>');b.find(".drop-area, .parameter-drop-area").makeDropZone(a(this))}},stop:function(){var b=a(this).closest(".view-adminruleeditor").find(".rule-area");0!==b.find(".item").length&&b.find(".drop-area").remove();a(this).show()}});return this};a(".view-adminruleeditor .rule-area .item").makeDraggableItem();a(".view-adminruleeditor #combinator-blueprints .item").makeDraggableItem();a(".view-adminruleeditor .selected-panel .item").makeDraggableItem();
a(".view-adminruleeditor").on("panelSelected",function(){a(".view-adminruleeditor .selected-panel .item").makeDraggableItem()});a(".view-adminruleeditor .drop-area").makeDropZone();a(".view-adminruleeditor .rule-area").on("click",".item",function(b){b.shiftKey||a(this).closest(".rule-area").find(".selected").removeClass("selected");a(b.target).is(".input")||(a(b.target).is(".item")?a(b.target).addClass("selected"):0!==a(b.target).closest(".item").length&&a(b.target).closest(".item").addClass("selected"))});
a(".view-adminruleeditor").on("click",function(b){!1===a(b.target).is(".item")&&0===a(b.target).closest(".item").length&&a(this).closest(".view-adminruleeditor").find(".rule-area .selected").removeClass("selected")});a(".view-adminruleeditor").on("click",".button-limit-condition-width",function(){a(this).closest(".view-adminruleeditor").find(".rule-area").toggleClass("squeeze")});a(".view-adminruleeditor").on("click",".button-remove-selected-items",h.removeSelectedItems);a(".view-adminruleeditor").on("click",
".button-put-in-brackets",h.putInBrackets);a(document).keyup(function(a){switch(a.which){case 46:h.removeSelectedItems.apply(this,arguments)}a.preventDefault()});a(".view-adminruleeditor").on("click",".button-store",h.storeRule);a(".view-adminruleeditor").on("click",".button-cancel",function(){a(this).closest(".modal").modal("hide").find(".modal-content").html("")});a(".view-adminruleeditor").on("click",".picker-tab",function(){var b=a(this).closest(".view-adminruleeditor"),c=a(this).attr("id");a(this).addClass("selected-tab").siblings().removeClass("selected-tab");
b.find(".picker-panels ."+c).addClass("selected-panel").siblings().removeClass("selected-panel");b.trigger("panelSelected",[c])});a(".view-adminruleeditor .condition input[type=text]").each(h.adjustTextFieldWidth);a(".view-adminruleeditor").on("keyup change click",".condition input[type=text]",h.adjustTextFieldWidth);a(".view-adminruleeditor").on("click",".condition-operator",function(){a(".condition .operator-picker").remove();("selectedOption.id"===a(this).closest(".condition").data("field")?a("#operator-picker-blueprint .operator-picker-short"):
a("#operator-picker-blueprint .operator-picker-full")).clone().appendTo(a(this))});a(".view-adminruleeditor").on("click",function(b){a(b.target).is(".condition-operator")||a(".condition .operator-picker").remove()});a(".view-adminruleeditor").on("click",".rule-area .operator, #condition-picker .operator",function(){var b=a(this).data("operator");a(this).closest(".condition").data("operator",b).attr("data-operator",b);a(this).closest(".condition-operator").text(a(this).text()+" ")});a(".view-adminruleeditor").on("change",
".page-filter select",function(){var b=parseInt(a(this).val());a(".question-picker li").removeClass("shown").removeClass("selected");a(0===b?".question-picker .question-list li":".question-picker .question-list li.page-"+b).addClass("shown");a("#question-filter").val("");a(".question-picker li.hidden-by-question-filter").removeClass("hidden-by-question-filter")});a("#question-filter").keyup(function(){var b=a(this).val();b=b.trim();b=b.toLowerCase();""===b&&a(".question-picker li").removeClass("hidden-by-question-filter");
a(".question-picker li.shown").each(function(){var c=a(this).text();c=c.trim();c=c.toLowerCase();-1===c.indexOf(b)?a(this).addClass("hidden-by-question-filter"):a(this).removeClass("hidden-by-question-filter")})});a(".view-adminruleeditor").on("click",".question-list li",function(){var b=a(this).data("question-id");a("#answer-group-"+b).show().siblings().hide();a("#question-attributes #answer-group-"+b+" .item").makeDraggableItem();a(this).addClass("picked").siblings().removeClass("picked");a("#question-attributes").show()})},
storeRule:function(){var b=a(this).closest(".view-adminruleeditor");b.find(".rule-area .drop-area").remove();var c=b.closest(".rule-editor-modal").data("form-property"),f="",e=h.getRuleItems(b.find(".rule-area")),d="1"===b.find(".rule-is-negated").val();if(!0===d&&0<e.length){var g=b.find(".rule-is-negated option[value=1]").data("prefix-rule-text");e.unshift({type:"negation"})}else g=b.find(".rule-is-negated option[value=0]").data("prefix-rule-text");e.length&&(f=JSON.stringify(e).replace(/^"/g,"").replace(/"$/g,
""));c.find(".data-field").val(f).trigger("change");b.find(".rule-area input").each(function(){a(this).replaceWith('<span class="condition-value">'+a(this).val()+"</span>")});e="";d&&(e+=g+" ");e+=b.find(".rule-area").html();b=c.find(".rule-html");b.html(e);f?b.closest(".rule-wrapper").addClass("has-rule").removeClass("has-no-rule"):b.closest(".rule-wrapper").removeClass("has-rule").addClass("has-no-rule");a(this).closest(".modal").modal("hide").find(".modal-content").html("")},getRuleItems:function(b){var c=
[];b=b.children(".item");for(var f in b)if(!0===b.hasOwnProperty(f)&&!0!==isNaN(parseInt(f))){var e=h.getItemMetadata(a(b[f]));switch(e.type){case "bracket":c[f]=h.getRuleItems(a(b[f]));break;case "function":var d=a(b[f]).find(".parameter");e.parameters=[];for(var g in d)if(d.hasOwnProperty(g)&&!0!==isNaN(parseInt(f))){var k=h.getRuleItems(a(d[g]));e.parameters.push(k)}c[f]=e;break;default:c[f]=e}}return c},getItemMetadata:function(b){var c=a(b).data(),f={},e;for(e in c)c.hasOwnProperty(e)&&"uiDraggable"!==
e&&(f[e]=c[e]);a(b).find(".input").each(function(){var b=a(this).data("data-key");if(b){var c=a(this).val(),e=c.replace(d.config.decimalSymbol,".");e=Number(e);!1===isNaN(e)&&(c=e);f[b]=c}});return f},putInBrackets:function(){var b=a(this).closest(".view-adminruleeditor"),c=Math.ceil(2E4*Math.random());b.find(".selected").wrapAll('<span class="item bracket" data-type="bracket" id="bracket-'+c+'" />');a("#bracket-"+c).makeDraggableItem().removeAttr("id");b.find(".rule-area .selected").removeClass("selected")},
removeSelectedItems:function(){var b=a(this).closest(".view-adminruleeditor");b.find(".selected").each(function(){a(this).is(".bracket")&&a(this).children().detach().clone(!0,!0).insertAfter(a(this));a(this).next(".combinator").remove();a(this).is(":last-child")&&a(this).prev(".combinator").remove();a(this).remove()});b.find(".rule-editor .parameter").each(function(){var b=a(this);if(0===b.find(".item").length){var d='<span class="parameter-drop-area">'+b.data("parameter-name")+"</span>";b.html(d)}})},
adjustTextFieldWidth:function(){var b=""===a(this).val()?a(this).attr("placeholder"):a(this).val();a("#width-tester").text(b);a("#width-tester").css("font-size",a(this).css("font-size"));a("#width-tester").css("font-family",a(this).css("font-family"));b=parseInt(a("#width-tester").css("width"));10>b&&(b=10);b+=10;a(this).css("width",b+"px")}};return h});
