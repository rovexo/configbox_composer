define(["cbj","configbox/configurator","configbox/server"],function(d,b,f){var c={onConfiguratorLoaded:function(){d(document).on("cbPricingChange",c.updateMagento2Total);d(document).trigger("cbConfiguratorInjected");c.initMagento2Validation();c.loadVisualization()},onVisualizationLoaded:function(){b.initImagePreloading()},initMagento2Validation:function(){window.require(["jquery","mage/validation"],function(a){a.validator.addMethod("configbox_m2_validation",function(a,c){var e=b.getConfiguratorData("missingProductSelections");
if(0===e.length)return a=b.getConfiguratorData("questions"),d.each(a,function(){b.clearValidationError(this.id)}),!0;a=parseInt(e[0].pageId);a!==b.getPageId()?b.switchPage(a,function(){window.setTimeout(function(){b.addValidationErrors(e)},100)}):b.addValidationErrors(e);return!1},"")})},updateMagento2Total:function(a,b){var c=b.total.price,e=b.total.priceNet,g=d(".view-m2configurator").data("magento-option-id");window.require(["jquery"],function(a){var b={};b["options["+g+"]"]={oldPrice:{amount:e,
adjustments:[]},basePrice:{amount:e},finalPrice:{amount:c}};a(".price-box").trigger("updatePrice",b)})},loadVisualization:function(){var a=d(".view-configuratorpage"),b=d(".view-m2visualization");a={positionId:a.data("cart-position-id"),productId:a.data("product-id"),pageId:a.data("page-id")};f.injectHtml(b,"m2configurator","getVisualizationHtml",a,c.onVisualizationLoaded)}};return{loadConfigurator:function(){var a=d(".view-m2configurator"),b={configInfo:a.data("config-info"),taxRate:a.data("tax-rate")};
f.injectHtml(a,"m2configurator","getConfiguratorHtml",b,c.onConfiguratorLoaded)}}});
