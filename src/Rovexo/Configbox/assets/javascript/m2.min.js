define(["cbj","configbox/configurator","configbox/server"],function(e,b,f){var c={onConfiguratorLoaded:function(){e(document).on("cbPricingChange",c.updateMagento2Total);c.initMagento2Validation();c.loadVisualization()},onVisualizationLoaded:function(){b.initImagePreloading()},initMagento2Validation:function(){window.require(["jquery","mage/validation"],function(a){a.validator.addMethod("configbox_m2_validation",function(a,c){var d=b.getConfiguratorData("missingProductSelections");if(0===d.length)return a=
b.getConfiguratorData("questions"),e.each(a,function(){b.clearValidationError(this.id)}),!0;a=parseInt(d[0].pageId);a!==b.getPageId()?b.switchPage(a,function(){window.setTimeout(function(){b.addValidationErrors(d)},100)}):b.addValidationErrors(d);return!1},"")})},updateMagento2Total:function(a,b){var c=b.total.price,d=b.total.priceNet,g=e(".view-m2configurator").data("magento-option-id");window.require(["jquery"],function(a){var b={};b["options["+g+"]"]={oldPrice:{amount:d,adjustments:[]},basePrice:{amount:d},
finalPrice:{amount:c}};a(".price-box").trigger("updatePrice",b)})},loadVisualization:function(){var a=e(".view-configuratorpage"),b=e(".view-m2visualization");a={positionId:a.data("cart-position-id"),productId:a.data("product-id"),pageId:a.data("page-id")};f.injectHtml(b,"m2configurator","getVisualizationHtml",a,c.onVisualizationLoaded)}};return{loadConfigurator:function(){var a=e(".view-m2configurator"),b={configInfo:a.data("config-info"),taxRate:a.data("tax-rate")};f.injectHtml(a,"m2configurator",
"getConfiguratorHtml",b,c.onConfiguratorLoaded)}}});
