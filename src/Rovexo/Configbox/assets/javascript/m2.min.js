define(["cbj","configbox/configurator","configbox/server"],function(c,d,g){var e={onConfiguratorLoaded:function(){c(document).on("cbPricingChange",e.updateMagento2Total);e.setMagento2Total();c(document).trigger("cbConfiguratorInjected");e.initMagento2Validation();e.loadVisualization()},onVisualizationLoaded:function(){d.initImagePreloading()},initMagento2Validation:function(){window.require(["jquery","mage/validation"],function(a){a.validator.addMethod("configbox_m2_validation",function(b,h){var f=
d.getConfiguratorData("missingProductSelections");if(0===f.length)return b=d.getConfiguratorData("questions"),c.each(b,function(){d.clearValidationError(this.id)}),!0;b=parseInt(f[0].pageId);b!==d.getPageId()?d.switchPage(b,function(){window.setTimeout(function(){d.addValidationErrors(f)},100)}):d.addValidationErrors(f);return!1},"")})},setMagento2Total:function(){var a=d.getCartPositionId();g.makeRequest("m2configurator","getPricing",{cartPositionId:a}).done(function(b){e.updateMagento2Total(null,
b);c(".price-box").css("visibility","visible")})},updateMagento2Total:function(a,b){var h=b.total.price,f=b.total.priceNet,l=c(".view-m2configurator").data("magento-option-id");window.require(["jquery"],function(m){var k={};k["options["+l+"]"]={oldPrice:{amount:f,adjustments:[]},basePrice:{amount:f},finalPrice:{amount:h}};m(".price-box").trigger("updatePrice",k)})},loadVisualization:function(){var a=c(".view-configuratorpage"),b=c(".view-m2visualization");a={positionId:a.data("cart-position-id"),
productId:a.data("product-id"),pageId:a.data("page-id")};g.injectHtml(b,"m2configurator","getVisualizationHtml",a,e.onVisualizationLoaded)}};return{loadConfigurator:function(){var a=c(".view-m2configurator"),b={configInfo:a.data("config-info"),taxRate:a.data("tax-rate")};c(".price-box").css("visibility","hidden");g.injectHtml(a,"m2configurator","getConfiguratorHtml",b,e.onConfiguratorLoaded)}}});
