var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.findInternal=function(d,f,a){d instanceof String&&(d=String(d));for(var e=d.length,b=0;b<e;b++){var c=d[b];if(f.call(a,c,b,d))return{i:b,v:c}}return{i:-1,v:void 0}};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(d,f,a){d!=Array.prototype&&d!=Object.prototype&&(d[f]=a.value)};
$jscomp.getGlobal=function(d){return"undefined"!=typeof window&&window===d?d:"undefined"!=typeof global&&null!=global?global:d};$jscomp.global=$jscomp.getGlobal(this);$jscomp.polyfill=function(d,f,a,e){if(f){a=$jscomp.global;d=d.split(".");for(e=0;e<d.length-1;e++){var b=d[e];b in a||(a[b]={});a=a[b]}d=d[d.length-1];e=a[d];f=f(e);f!=e&&null!=f&&$jscomp.defineProperty(a,d,{configurable:!0,writable:!0,value:f})}};
$jscomp.polyfill("Array.prototype.find",function(d){return d?d:function(d,a){return $jscomp.findInternal(this,d,a).v}},"es6","es3");
define(["configbox/server","kenedo","cbj","cbj.ui","cbj.chosen"],function(d,f,a){var e={initProductTreeOnce:function(){a(document).on("change",".view-adminproducttree #product_tree_list_id",function(){var b=a(this).val(),c=a(this).closest(".view-adminproducttree").find(".product-list").data("update-url");a(this).closest(".product-tree-wrapper").load(c,{list_id:b},function(c,b){"error"==b?window.alert("System Error!"):a(document).trigger("cbViewInjected")})});a(document).on("keyup",".view-adminproducttree #product-tree-title",
function(){var b=a(this).val().toLowerCase();a(".product-edit-link").each(function(){-1===a(this).text().toLowerCase().indexOf(b)?a(this).closest(".product-item").hide():a(this).closest(".product-item").show()})});a(document).on("click",".view-adminproducttree .sub-list-trigger",function(){a(this).is(".trigger-opened")?(a(this).removeClass("trigger-opened"),a(this).siblings(".sub-list").removeClass("list-opened")):(a(this).addClass("trigger-opened"),a(this).siblings(".sub-list").addClass("list-opened"))});
a(document).on("click",".view-adminproducttree .edit-link, .view-adminproducttree .add-link",function(){a(this).closest(".view-adminproducttree").find(".active").removeClass("active");a(this).closest("li").addClass("active")});a(document).on("click",".view-adminproducttree .toggle-tree-edit",function(){a(this).toggleClass("active");a(this).closest(".product-tree-wrapper").toggleClass("shows-edit-buttons")});a(document).on("click",".view-adminproducttree .trigger-copy",function(){var b=a(this).data("controller"),
c=a(this).data("id"),d=a(this).data("short-name");cbrequire(["configbox/server"],function(g){g.makeRequest(b,"copy",{id:c}).done(function(b){if(!1===b.success)window.alert(b.errors.join("\n"));else{b.redirectUrl&&f.loadSubview(b.redirectUrl);var c=a(".view-adminproducttree .product-list").data("update-url"),g=encodeURIComponent(JSON.stringify(e.getOpenProductTreeBranchIds()));c+="&open_branch_ids="+g;a(".product-tree-wrapper").load(c,function(){a(document).trigger("cbViewInjected");a(this).closest(".view-adminproducttree").find(".active").removeClass("active");
var c="#"+d+"-"+b.newId;a(this).closest(".view-adminproducttree").find(c).addClass("active")})}})})});a(document).on("click",".view-adminproducttree .trigger-remove",function(){var b=a(this);if(!b.hasClass("processing")){b.addClass("processing");var c=a(this).closest("li");a.ajax({url:b.data("url"),dataType:"json",success:function(a){b.removeClass("processing");0==a.success?window.alert(a.errors.join("\n")):c.remove()},error:function(a,b,c){console.log(b);console.log(c)},always:function(){b.removeClass("processing")}})}});
a(document).on("kenedoFormResponseReceived",function(b,c){if(1==c.response.success&&"undefined"!=typeof c.viewName&&""!=c.viewName&&c.response.data&&c.response.data.id){var d;b=c.response.data.id;var f=c.viewName.replace("admin",""),h=!1;"adminproduct"==c.viewName&&(b=d=c.response.data.id,h=c.response.wasInsert);"adminpage"==c.viewName&&(d=a("#product_id").val());"adminelement"==c.viewName&&(d=a("#page-"+a("#page_id").val()).closest(".product-item").attr("id").replace("product-",""));e.refreshProductTree(b,
f,d,h)}})},initProductTreeEach:function(){a("#product_tree_list_id").chosen();e.makeTreeSortable()},makeTreeSortable:function(){a(".view-adminproducttree .page-list, .view-adminproducttree .question-list, .view-adminproducttree .answer-list").sortable({placeholder:"ui-state-highlight",items:"li:not(.add-item)",update:function(){var b=a(this),c=b.sortable("toArray");b.sortable("disable");var g="",e="";b.is(".page-list")&&(g="adminpages",e="page-");b.is(".question-list")&&(g="adminelements",e="question-");
b.is(".answer-list")&&(g="adminoptionassignments",e="answer-");var f=[],k=10,l;for(l in c)c.hasOwnProperty(l)&&-1!=c[l].indexOf(e)&&(f.push('"'+c[l].replace(e,"")+'" : '+k),k+=10);c="{"+f.join(",")+"}";g="option=com_configbox&controller="+g+"&task=storeOrdering&format=raw&tmpl=component&ordering-items="+encodeURIComponent(c);a.post(d.config.urlXhr,g,function(){b.sortable("enable")})}});a(".view-adminproducttree .product-item ul").disableSelection()},refreshProductTree:function(b,c,g,f){if(0!=a(".view-adminproducttree").length){var h=
a(".view-adminproducttree .product-list").data("update-url"),k=encodeURIComponent(JSON.stringify(this.getOpenProductTreeBranchIds()));"magento"==d.config.platformName?h+="open_branch_ids/"+k+"/only_product_id/"+g:(h+=-1==h.indexOf("?")?"?":"&",h+="open_branch_ids="+k+"&only_product_id="+g);f&&a(".view-adminproducttree .product-list .product-item.add-item").before('<li class="product-item" id="product-'+g+'"></li>');a("#product-"+g).load(h+" #product-"+g+">div",function(){e.makeTreeSortable();a(".view-adminproducttree .active").removeClass("active");
"element"==c&&(c="question");a("#"+c+"-"+b).addClass("active")})}},getOpenProductTreeBranchIds:function(){var b={products:[],pages:[],questions:[]};a(".sub-list-trigger").each(function(c,d){a(d).is(".trigger-opened")&&(c=a(this).attr("id"))&&(-1!=c.indexOf("product-trigger")&&b.products.push(c.replace("product-trigger-","")),-1!=c.indexOf("page-trigger")&&b.pages.push(c.replace("page-trigger-","")),-1!=c.indexOf("question-trigger")&&b.questions.push(c.replace("question-trigger-","")))});return b}};
return e});
