var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.findInternal=function(b,d,a){b instanceof String&&(b=String(b));for(var f=b.length,c=0;c<f;c++){var e=b[c];if(d.call(a,e,c,b))return{i:c,v:e}}return{i:-1,v:void 0}};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.SIMPLE_FROUND_POLYFILL=!1;
$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(b,d,a){b!=Array.prototype&&b!=Object.prototype&&(b[d]=a.value)};$jscomp.getGlobal=function(b){b=["object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof global&&global,b];for(var d=0;d<b.length;++d){var a=b[d];if(a&&a.Math==Math)return a}return globalThis};$jscomp.global=$jscomp.getGlobal(this);
$jscomp.polyfill=function(b,d,a,f){if(d){a=$jscomp.global;b=b.split(".");for(f=0;f<b.length-1;f++){var c=b[f];c in a||(a[c]={});a=a[c]}b=b[b.length-1];f=a[b];d=d(f);d!=f&&null!=d&&$jscomp.defineProperty(a,b,{configurable:!0,writable:!0,value:d})}};$jscomp.polyfill("Array.prototype.find",function(b){return b?b:function(b,a){return $jscomp.findInternal(this,b,a).v}},"es6","es3");
define(["configbox/server","kenedo","cbj","cbj.ui","cbj.chosen"],function(b,d,a){var f={initProductTreeOnce:function(){a(document).on("change",".view-adminproducttree #product_tree_list_id",function(){var c=a(this).val(),b=a(this).closest(".view-adminproducttree").find(".product-list").data("update-url");a(this).closest(".product-tree-wrapper").load(b,{list_id:c},function(c,b){"error"===b?window.alert("System Error!"):a(document).trigger("cbViewInjected")})});a(document).on("keyup",".view-adminproducttree #product-tree-title",
function(){var c=a(this).val().toLowerCase();a(".product-edit-link").each(function(){-1===a(this).text().toLowerCase().indexOf(c)?a(this).closest(".product-item").hide():a(this).closest(".product-item").show()})});a(document).on("click",".view-adminproducttree .sub-list-trigger",function(){a(this).is(".trigger-opened")?(a(this).removeClass("trigger-opened"),a(this).siblings(".sub-list").removeClass("list-opened")):(a(this).addClass("trigger-opened"),a(this).siblings(".sub-list").addClass("list-opened"))});
a(document).on("click",".view-adminproducttree .edit-link, .view-adminproducttree .add-link",function(){a(this).closest(".view-adminproducttree").find(".active").removeClass("active");a(this).closest("li").addClass("active")});a(document).on("click",".view-adminproducttree .toggle-tree-edit",function(){a(this).toggleClass("active");a(this).closest(".product-tree-wrapper").toggleClass("shows-edit-buttons")});a(document).on("click",".view-adminproducttree .trigger-copy",function(){var c=a(this).data("controller"),
b=a(this).data("id"),g=a(this).data("short-name");cbrequire(["configbox/server"],function(e){e.makeRequest(c,"copy",{id:b}).done(function(c){if(!1===c.success)window.alert(c.errors.join("\n"));else{c.redirectUrl&&d.loadSubview(c.redirectUrl);var b=a(".view-adminproducttree .product-list").data("update-url"),e=encodeURIComponent(JSON.stringify(f.getOpenProductTreeBranchIds()));b+="&open_branch_ids="+e;a(".product-tree-wrapper").load(b,function(){a(document).trigger("cbViewInjected");a(this).closest(".view-adminproducttree").find(".active").removeClass("active");
var b="#"+g+"-"+c.newId;a(this).closest(".view-adminproducttree").find(b).addClass("active")})}})})});a(document).on("click",".view-adminproducttree .trigger-remove",function(){var c=a(this);if(!c.hasClass("processing")){c.addClass("processing");var b=a(this).closest("li");a.ajax({url:c.data("url"),dataType:"json",success:function(a){c.removeClass("processing");!1===a.success?window.alert(a.errors.join("\n")):b.remove()},error:function(a,b,c){console.log(b);console.log(c)},always:function(){c.removeClass("processing")}})}});
a(document).on("cbFormTaskResponseReceivedGlobal",function(b,e,g){try{var c=JSON.parse(e.responseText)}catch(k){console.warn('Could not parse JSON response. Response text was: "'+e.responseText+'"');console.warn("Error message follows:");console.warn(k);return}if(!0===c.success){var d;b=c.data.id;e=g.viewName.replace("admin","");var h=!1;"adminproduct"===g.viewName&&(b=d=c.data.id,h=c.wasInsert);"adminpage"===g.viewName&&(d=c.data.product_id);"adminelement"===g.viewName&&(g=c.data.page_id,d=a(".view-adminproducttree").find("#page-"+
g).closest(".product-item").attr("id").replace("product-",""));f.refreshProductTree(b,e,d,h)}})},initProductTreeEach:function(){a("#product_tree_list_id").chosen();f.makeTreeSortable()},makeTreeSortable:function(){a(".view-adminproducttree .page-list, .view-adminproducttree .question-list, .view-adminproducttree .answer-list").sortable({placeholder:"ui-state-highlight",items:"li:not(.add-item)",update:function(){var c=a(this),e=c.sortable("toArray");c.sortable("disable");var d="",f="";c.is(".page-list")&&
(d="adminpages",f="page-");c.is(".question-list")&&(d="adminelements",f="question-");c.is(".answer-list")&&(d="adminoptionassignments",f="answer-");var l=10,h={},k;for(k in e)if(e.hasOwnProperty(k)&&-1!==e[k].indexOf(f)){var n=e[k].replace(f,"");h[n]=l;l+=10}e={updates:JSON.stringify(h)};b.makeRequest(d,"storeOrdering",e).done(function(){c.sortable("enable")})}});a(".view-adminproducttree .product-item ul").disableSelection()},refreshProductTree:function(c,e,d,m){if(0!==a(".view-adminproducttree").length){var g=
a(".view-adminproducttree .product-list").data("update-url"),h=encodeURIComponent(JSON.stringify(this.getOpenProductTreeBranchIds()));"magento"===b.config.platformName?g+="open_branch_ids/"+h+"/only_product_id/"+d:(g+=-1===g.indexOf("?")?"?":"&",g+="open_branch_ids="+h+"&only_product_id="+d);m&&a(".view-adminproducttree .product-list .product-item.add-item").before('<li class="product-item" id="product-'+d+'"></li>');a("#product-"+d).load(g+" #product-"+d+">div",function(){f.makeTreeSortable();a(".view-adminproducttree .active").removeClass("active");
"element"===e&&(e="question");a("#"+e+"-"+c).addClass("active")})}},getOpenProductTreeBranchIds:function(){var b={products:[],pages:[],questions:[]};a(".sub-list-trigger").each(function(c,d){a(d).is(".trigger-opened")&&(c=a(this).attr("id"))&&(-1!==c.indexOf("product-trigger")&&b.products.push(c.replace("product-trigger-","")),-1!==c.indexOf("page-trigger")&&b.pages.push(c.replace("page-trigger-","")),-1!==c.indexOf("question-trigger")&&b.questions.push(c.replace("question-trigger-","")))});return b}};
return f});
