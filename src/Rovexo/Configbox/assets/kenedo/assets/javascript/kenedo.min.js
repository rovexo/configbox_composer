define(["cbj","configbox/server"],function(a,u){var d={initAdminPage:function(){this.initNewContent(a(".view-admin, .view-blank"));this.afterInitNewContent(a(".view-admin, .view-blank"));window.addEventListener("popstate",function(a){"undefined"!=typeof a.state&&null!==a.state&&!0===a.state.isSubview&&(d.loadSubview(a.state.url,a.state.targetSelector,a.state.callbackFunction,!1),a.preventDefault())});a(document).on("click",".ajax-target-link",function(b){if(1!=b.shiftKey||1!=b.metaKey)d.loadSubview(a(this).attr("href")),
b.preventDefault()});a(document).on("click",".task-toggle-help",function(){a(this).toggleClass("active");a(".kenedo-details-form").toggleClass("show-help")});a(document).on("click",".trigger-open-modal",function(b){b.preventDefault();var c=a(this).data("modal-width"),e=a(this).data("modal-height"),h=a(this).attr("href");c||(c=900);e||(e=600);cbrequire(["cbj.colorbox"],function(){a.colorbox({transition:"fade",href:h,overlayClose:!0,iframe:!0,fastIframe:!1,width:c,height:e})})});a(document).on("click",
".kenedo-new-tab, .new-tab",function(a){window.open(this.href);a.preventDefault()});a(document).on("click",".trigger-picker-select",function(b){b.preventDefault();var c=a(this).attr("href");cbrequire(["cbj.colorbox"],function(){a.colorbox({transition:"fade",href:c,overlayClose:!0,iframe:!0,fastIframe:!1,width:"1200px",height:"600px"})})});a(document).on("click",".listing-link",function(b){if(0!=a(this).closest(".param-picker").length){b.preventDefault();b=a(this).closest(".item-row").data("item-id");
var c=a(this).text(),e=a(this).closest(".kenedo-listing-form").find(".listing-data-pickerobject").data("value"),h=a(this).closest(".kenedo-listing-form").find(".listing-data-pickermethod").data("value");if(h&&"undefined"!=typeof parent.window[h])parent.window[h](b);parent.window.document.getElementById(e+"_id")&&(parent.window.document.getElementById(e+"_id").value=b,parent.window.document.getElementById(e+"_name").value=c);window.parent.cbrequire&&window.parent.cbrequire(["cbj","cbj.colorbox"],function(a){a.colorbox.close()});
window.parent.jQuery&&window.parent.jQuery("#"+e+"-modal").modal&&window.parent.jQuery("#"+e+"-modal").modal("hide")}});a(document).on("click",".property-type-translatable .language-switcher",function(){a(this).siblings().removeClass("active");a(this).addClass("active");var b=a(this).attr("for");a("#translation-"+b).show().siblings().hide()});a(document).on("change",".kenedo-property :input",function(){var b=a(this).closest(".kenedo-property").attr("id").replace("property-name-",""),c=a(this).val(),
e=a(this).closest(".kenedo-details-form").data("record");"undefined"!=typeof e[b]&&(e[b]=c);a(this).closest(".kenedo-details-form").trigger("kenedoFormDataChanged",[e,b,c])});a(document).on("click",".property-group-using-toggles>.property-group-legend",function(){a(this).closest(".property-group").hasClass("property-group-opened")?(a(this).closest(".property-group").removeClass("property-group-opened").addClass("property-group-closed"),a(this).closest(".property-group").find(".property-group-toggle-state").val("closed")):
(a(this).closest(".property-group").removeClass("property-group-closed").addClass("property-group-opened"),a(this).closest(".property-group").find(".property-group-toggle-state").val("opened"))});a(document).on("change",".join-select",function(){a(this).closest(".property-body").find(".join-link").hide();a(this).closest(".property-body").find(".join-link-"+a(this).val()).show()});a(document).on("click",".show-file-uploader",function(b){b.preventDefault();b=a(this).closest(".property-body").find(".file-upload-field").clone();
a(this).data("inputfield",b);a(this).closest(".property-body").find(".file-uploader").slideDown(300);a(this).closest(".property-body").find(".file-current-file, .file-delete, .file-upload").slideUp(300)});a(document).on("click",".file-upload-cancel",function(b){b.preventDefault();a(this).closest(".property-body").find(".file-uploader").slideUp(300);a(this).closest(".property-body").find(".file-current-file, .file-delete, .file-upload").slideDown(300);b=a(this).closest(".property-body").find(".show-file-uploader").data("inputfield");
a(this).closest(".property-body").find(".file-upload-field").replaceWith(b)});a(document).on("click",".order-property",d.changeListingOrder);a(document).on("change",".listing-filter",d.changeListingFilters);a(document).on("click",".link-save-item-ordering",d.storeOrdering);a(document).on("click",".kenedo-check-all-items",d.toggleCheckboxes);a(document).on("click",".kenedo-pagination-list a",d.changeListingStart);a(document).on("change",".kenedo-limit-select",d.changeListingLimit);a(document).on("click",
".kenedo-trigger-toggle-active",d.toggleActive);a(document).on("click",".kenedo-details-form .kenedo-task-list .task",d.executeFormTask);a(document).on("click",".kenedo-listing-form .kenedo-task-list .task",d.executeListingTask);a(document).on("click",".listing-link",d.openListingLink);a(document).on("keyup",".ordering-text-field",function(){a(this).closest(".kenedo-listing").find(".link-save-item-ordering").show()});a(document).on("mouseenter",".kenedo-popup-trigger",f.cancelClosing);a(document).on("mouseenter",
".kenedo-popup-trigger",f.scheduleOpening);a(document).on("mouseleave",".kenedo-popup-trigger",f.scheduleClosing);a(document).on("mouseleave",".kenedo-popup-trigger",f.cancelOpening);a(document).on("mouseleave",".kenedo-popup",f.scheduleClosing);a(document).on("mouseenter",".kenedo-popup",f.cancelClosing);a(".kenedo-popup-trigger").click(function(b){b.stopPropagation();b.preventDefault();a(this).trigger("mouseenter")});a(document).on("click",".trigger-select-all-multi",function(){a(this).closest(".kenedo-property").find(".property-body option").prop("selected",
!0);a(this).closest(".kenedo-property").find(".property-body input").prop("checked",!0)});a(document).on("click",".trigger-deselect-all-multi",function(){a(this).closest(".kenedo-property").find(".property-body option").prop("selected",!1);a(this).closest(".kenedo-property").find(".property-body input").prop("checked",!1)})},loadSubview:function(b,c,e,h){c||(c=".configbox-ajax-target");var k;if("object"==typeof b){if(a(this).closest(".intra-listing").length)return;k=b.value}"string"==typeof b&&""!=
b&&(k=b);if(!k)throw"loadSubview called, but no URL could be determined.";!1!==h&&window.history.pushState({isSubview:!0,url:k,targetSelector:c,callbackFunction:e},"",k);-1==k.indexOf("ajax_sub_view")&&(k="magento"==u.config.platformName?k+"ajax_sub_view/1/format/raw":k+(-1==k.indexOf("?")?"?ajax_sub_view=1&format=raw":"&ajax_sub_view=1&format=raw"));cbrequire(["tinyMCE"],function(a){3<a.majorVersion&&a.remove()});a(c).animate({opacity:".0"},200,function(){a(c).load(k+" .kenedo-view:first",function(b,
h,k){200!==k.status&&(b='<div id="view-error" class="kenedo-view kenedo-ajax-sub-view"><div class="kenedo-listing-form">'+("<p>Encountered a system error: HTTP code is "+k.status+". Text message is: "+k.statusText+"</p>"),b+="</div>",b+="</div>",a(c).html(b));d.initNewContent(a(c));a(c).animate({opacity:"1"},400,function(){d.afterInitNewContent(a(c));"function"==typeof e&&e(a(c))})})})},initNewContent:function(b){0!=a(b).length&&(a(b).find("select.listing-filter, select.join-select, .property-type-dropdown select, .make-me-chosen, .chosen-dropdown").length&&
cbrequire(["cbj.chosen"],function(){a(b).find("select.listing-filter, select.join-select, .property-type-dropdown select, .make-me-chosen, .chosen-dropdown").chosen({disable_search_threshold:10,search_contains:!0,inherit_select_classes:!0,width:"100%"});a(b).find(".chosen-container:hidden").each(function(){a(this).is(".join-select")?a(this).css("width","100%"):a(this).closest(".kenedo-properties").length?a(this).css("width","100%"):a(this).css("width","auto")})}),a(b).find(".sortable-listing tbody").length&&
cbrequire(["cbj.ui"],function(){a(b).find(".sortable-listing tbody").sortable(d.listingSortableSettings)}),a(b).find(".datepicker").length&&cbrequire(["cbj.ui"],function(){a(b).find(".datepicker").datepicker({dateFormat:"yy-mm-dd"})}),a(b).find(".kenedo-view").each(function(){var b=a(this).attr("id");b&&d.runSubviewReadyFunctions(b)}),a(b).find(".kenedo-details-form").each(function(){var b=a(this).closest(".kenedo-details-form").data("record");d.setPropertyVisibility(null,b);a(this).on("kenedoFormDataChanged",
d.setPropertyVisibility)}),a(b).find(".kenedo-listing .ordering-text-field").attr("autocomplete","off"),a(document).trigger("cbViewInjected"))},afterInitNewContent:function(a){0!==a.find(".kenedo-html-editor").length&&cbrequire(["tinyMCE","configbox/server"],function(a,b){a.init({convert_urls:!1,document_base_url:b.config.urlBase,documentBaseURL:b.config.urlBase,baseURL:b.config.urlTinyMceBase,suffix:!0===b.config.useMinifiedJs?".min":"",mode:"textareas",selector:".kenedo-html-editor",theme:"modern",
plugins:["advlist autolink link image lists charmap print preview hr anchor pagebreak spellchecker","searchreplace wordcount visualblocks visualchars code fullscreen insertdatetime nonbreaking","save table contextmenu directionality emoticons template paste textcolor"],toolbar:"insertfile undo redo | styleselect | bold italic | alignleft aligncenter alignright alignjustify | bullist numlist outdent indent | l      ink image | print preview media fullpage | forecolor backcolor emoticons",content_css:"",
template_external_list_url:"js/template_list.js",external_link_list_url:"js/link_list.js",external_image_list_url:"js/image_list.js",media_external_list_url:"js/media_list.js",style_formats:[{title:"Headers",items:[{title:"Header 1",format:"h1"},{title:"Header 2",format:"h2"},{title:"Header 3",format:"h3"},{title:"Header 4",format:"h4"},{title:"Header 5",format:"h5"},{title:"Header 6",format:"h6"}]},{title:"Inline",items:[{title:"Bold",icon:"bold",format:"bold"},{title:"Italic",icon:"italic",format:"italic"},
{title:"Underline",icon:"underline",format:"underline"},{title:"Strikethrough",icon:"strikethrough",format:"strikethrough"},{title:"Superscript",icon:"superscript",format:"superscript"},{title:"Subscript",icon:"subscript",format:"subscript"},{title:"Code",icon:"code",format:"code"}]},{title:"Blocks",items:[{title:"Paragraph",format:"p"},{title:"Blockquote",format:"blockquote"},{title:"Div",format:"div"},{title:"Pre",format:"pre"}]},{title:"Alignment",items:[{title:"Left",icon:"alignleft",format:"alignleft"},
{title:"Center",icon:"aligncenter",format:"aligncenter"},{title:"Right",icon:"alignright",format:"alignright"},{title:"Justify",icon:"alignjustify",format:"alignjustify"}]},{title:"Others",items:[{title:"Custom 1",selector:"p",classes:"custom-1"},{title:"Custom 2",selector:"p",classes:"custom-2"},{title:"Custom 3",selector:"p",classes:"custom-3"},{title:"Custom 4",selector:"p",classes:"custom-4"}]}]})})},addedStylesheets:[],addStylesheet:function(b){-1===this.addedStylesheets.indexOf(b.toLowerCase())&&
(this.addedStylesheets.push(b.toLowerCase()),b='<link rel="stylesheet" type="text/css" href="'+b+'">',a("head").append(b))},subviewReadyFunctions:{},base64UrlEncode:function(a){return t.encode(a).replace(/\+/g,"-").replace(/\//g,"_").replace(/=/g,",")},base64UrlDecode:function(a){a=a.replace(/-/g,"+").replace(/_/g,"/").replace(/,/g,"=");return t.decode(a)},openListingLink:function(b){if(a(this).closest(".intra-listing").length){b.preventDefault();var c=function(){a.colorbox.resize({height:"95%",width:"95%"})},
e={transition:"fade",href:a(this).attr("href"),overlayClose:!0,iframe:!0,fastIframe:!1,width:"95%",height:"95%",onComplete:function(){a(window.parent).on("resize",c);a(window.top.document).find("body").css("overflow","hidden");a(window.top).trigger("resize")},onClosed:function(){a(window.parent).off("resize",c);a(window.top.document).find("body").css("overflow","auto")}};"magento"==u.config.platformName?e.href+="in_modal/1/tmpl/component":-1==e.href.indexOf("?")?e.href+="?in_modal=1&tmpl=component":
e.href+="&in_modal=1&tmpl=component";cbrequire(["cbj.colorbox"],function(){a.colorbox(e)})}else{var h=a(this).attr("href");d.loadSubview(h);b.preventDefault()}},setPropertyVisibility:function(b,c){var e={},h,d,g,p,f,r;c||(c={});a(".kenedo-details-form .property-group").each(function(){r=a(this).attr("id");r=r.replace("property-name-","");c[r]=""});for(var l in c)if(c.hasOwnProperty(l)&&(e=a("#property-name-"+l).data("propertyDefinition"))&&(f=!0,!a("#property-name-"+l).hasClass("invisible-field"))){if(e.appliesWhen)for(h in e.appliesWhen)if(e.appliesWhen.hasOwnProperty(h)){d=
c[h];g=e.appliesWhen[h];"object"!=typeof g&&(g=[g]);p=!1;for(var m in g)if(g.hasOwnProperty(m)){var n="is";"string"==typeof g[m]&&"!"==g[m].substr(0,1)&&(g[m]=g[m].substr(1),n="is not");if("is"===n){if("*"==g[m]&&d&&"0"!=d){p=!0;break}if(g[m]==d){p=!0;break}}else{if("*"==g[m]&&(!d||"0"==d)){p=!0;break}if(g[m]!=d){p=!0;break}}}0==p&&(f=!1)}f?"none"==a("#property-name-"+l).css("display")&&(a("#property-name-"+l).show(),e="undefined"!==typeof e["default"]?e["default"]:"")&&(a("#"+l).is("select")?a("#"+
l).val(e).change().trigger("chosen:updated"):a("#"+l).val(e),c[l]=e):"none"!=a("#property-name-"+l).css("display")&&(a("#property-name-"+l).hide(),e="undefined"!==typeof e["default"]?e["default"]:"",a("#"+l).is("select")&&""==e&&(e=0),a("#"+l).val(e).trigger("chosen:updated"),a("#property-name-"+l+".property-type-translatable .form-control").val(e),c[l]=e)}},listingSortableSettings:{handle:".sort-handle",items:"tr",axis:"y",scroll:!1,helper:function(b,c){c.children().each(function(){a(this).width(a(this).width())});
return c},start:function(){var b=[],c=[],e=a(this).sortable("toArray"),h;for(h in e)!0===e.hasOwnProperty(h)&&(b.push(a("#"+e[h]+" .ordering-text-field").val()),c.push(e[h].replace("item-id-","")));a(this).data("currentOrdering",b);a(this).data("currentItemIds",c)},update:function(){a(this).closest(".kenedo-listing-form").find(".link-save-item-ordering").show();var b=[],c=[],e=a(this).data("currentOrdering"),h=a(this).sortable("toArray"),d;for(d in h)!0===h.hasOwnProperty(d)&&(c.push(h[d].replace("item-id-",
"")),b.push(e[d]));for(d in b)!0===b.hasOwnProperty(d)&&a(this).find("#item-id-"+c[d]+" .ordering-text-field").val(e[d]);e=b;a(this).data("currentOrdering",e);a(this).data("currentItemIds",c)}},requiredFields:[],messages:{error:[],notice:[]},success:!1,reloadIntraListings:function(){a(".intra-listing").each(function(){var b=a(this).data("listing-url");a(this).load(b,function(){a(this).find(".sortable-listing tbody").sortable(d.listingSortableSettings)})})},toggleActive:function(){var b=a(this).data("id"),
c=a(this).data("active")?"unpublish":"publish";a(this).find(".fa").addClass("fa-spinner fa-spin");a(this).closest(".kenedo-listing-form").find(".listing-data-ids").data("value",b);a(this).closest(".kenedo-listing-form").find(".listing-data-task").data("value",c);d.updateListingForm(a(this))},executeListingTask:function(b){b.stopPropagation();b=a(this).attr("class").replace("task-","").replace("task","").replace("non-ajax","").replace(" ","");var c=[];a(this).closest(".kenedo-listing-form").find(".kenedo-item-checkbox").each(function(){1==
a(this).prop("checked")&&c.push(a(this).val())});var e=c.join(",");a(this).closest(".kenedo-listing-form").find(".listing-data-ids").data("value",e);if("add"==b)if(b=d.base64UrlDecode(a(this).closest(".kenedo-listing-form").find(".listing-data-add-link").data("value")),a(this).closest(".intra-listing").length){var h=function(){a.colorbox.resize({height:"95%",width:"95%"})},k={transition:"fade",href:b,overlayClose:!0,iframe:!0,fastIframe:!1,width:1E3,height:"95%",onComplete:function(){a(window.parent).on("resize",
h);a(window.top.document).find("body").css("overflow","hidden");a(window.top).trigger("resize")},onClosed:function(){a(window.parent).off("resize",h);a(window.top.document).find("body").css("overflow","auto")}};cbrequire(["cbj.colorbox"],function(){a.colorbox(k)})}else 1==a(this).closest(".kenedo-listing-form").find(".listing-data-ajax_sub_view").data("value")?d.loadSubview(b):window.location.href=b;else a(this).closest(".kenedo-listing-form").find(".listing-data-task").data("value",b),d.updateListingForm(a(this))},
registerSubviewReadyFunction:function(a,c){"undefined"==typeof d.subviewReadyFunctions[a]&&(d.subviewReadyFunctions[a]=[]);d.subviewReadyFunctions[a].push(c)},runSubviewReadyFunctions:function(b){"undefined"!=typeof d.subviewReadyFunctions[b]&&a.each(d.subviewReadyFunctions[b],function(a,b){"function"==typeof b&&b()})},changeListingStart:function(){var b=a(this).attr("class").replace("page-start-","");a(this).closest(".kenedo-listing-form").find(".listing-data-limitstart").data("value",b);d.updateListingForm(a(this))},
changeListingFilters:function(){d.updateListingForm(a(this))},changeListingLimit:function(){var b=a(this).val();a(this).closest(".kenedo-listing-form").find(".listing-data-limit").data("value",b);d.updateListingForm(a(this))},updateListingForm:function(b){b||(b=a(this));var c=a(b).closest(".kenedo-listing-form").find(".listing-data-base-url").data("value");-1==c.indexOf("?")&&(c+="?");a(b).closest(".kenedo-listing-form").find(".listing-data").each(function(){var b=a(this).data("key");if("base-url"!=
b){var e=a(this).data("value");c+="&"+b+"="+encodeURIComponent(e)}});a(b).closest(".kenedo-listing-form").find(".listing-filter").each(function(){var b=a(this).attr("name"),e=a(this).val();c+="&"+b+"="+encodeURIComponent(e)});if(b.hasClass("non-ajax"))window.location.href=c;else{var e=a(".view-admin");a(b).closest(".intra-listing").length?e=a(b).closest(".intra-listing"):0!==a(b).closest(".kenedo-view.param-picker").length?e=a(b).closest(".kenedo-view.view-blank"):a(b).closest(".configbox-ajax-target").length&&
(e=a(b).closest(".configbox-ajax-target"));e.load(c+" .kenedo-view:first",function(){d.initNewContent(e);d.afterInitNewContent(e);0!=a(this).find(".kenedo-messages li").length&&a(this).find(".kenedo-messages").slideDown(200);0!=a(this).find(".kenedo-messages-error li").length&&a(this).find(".kenedo-messages-error").slideDown(200);0!=a(this).find(".kenedo-messages-notice li").length&&a(this).find(".kenedo-messages-notice").slideDown(200)})}},toggleCheckboxes:function(){var b=a(".kenedo-listing .kenedo-check-all-items").prop("checked");
a(this).closest(".kenedo-listing").find(".kenedo-item-checkbox").prop("checked",b)},storeOrdering:function(){if(!a(this).hasClass("clicked")){a(this).addClass("clicked");a(this).find(".fa").removeClass("fa-floppy-o").addClass("fa-spinner").addClass("fa-spin");a(this).closest(".kenedo-listing-form").find(".listing-data-task").data("value","storeOrdering");var b=[];a(this).closest(".kenedo-listing-form").find(".item-row").each(function(){var c=a(this).data("item-id"),d=a(this).find(".ordering-text-field").val();
b.push('"'+c+'":'+d)});var c="{"+b.join(",")+"}";a(this).closest(".kenedo-listing-form").find(".listing-data-ordering-items").data("value",c);d.updateListingForm(a(this))}},changeListingOrder:function(){var b=a(this).attr("id").replace("order-property-name-",""),c="",c=a(this).hasClass("active")?a(this).hasClass("direction-asc")?"desc":"asc":"asc";a(this).closest(".kenedo-listing-form").find(".listing-data-listing_order_property_name").data("value",b);a(this).closest(".kenedo-listing-form").find(".listing-data-listing_order_dir").data("value",
c);d.updateListingForm(a(this))},isViewInModal:function(){return"1"===a("#in_modal").val()},isViewAjaxView:function(){return"1"===a("#ajax_sub_view").val()},getReturnUrl:function(){return d.base64UrlDecode(a("#return").val())},getTask:function(){return a("#task").val()},getViewName:function(){return a(".kenedo-details-form").data("view")},formTaskHandlers:{},getFormTaskHandler:function(a){return this.formTaskHandlers[a]||d.defaultFormTaskHandler},setFormTaskHandler:function(a,c){this.formTaskHandlers[a]=
c},formTaskResponseHandlers:{},getFormTaskResponseHandler:function(a){return this.formTaskResponseHandlers[a]||d.defaultFormTaskResponseHandler},setFormTaskResponseHandler:function(a,c){this.formTaskResponseHandlers[a]=c},executeFormTask:function(b){if(!a(this).closest(".kenedo-listing-form").length){var c=a(this).attr("class").replace("task-","").replace("task","").replace(" ",""),e=d.getViewName();a("#task").val(c);d.getFormTaskHandler(e)(e,c,b)}},defaultFormTaskHandler:function(a,c,e){switch(c){case "cancel":d.defaultFormTaskHandlerCancel(a,
e);break;case "store":d.defaultFormTaskHandlerStore(a,e);break;case "storeAndNew":d.defaultFormTaskHandlerStore(a,e);break;case "apply":d.defaultFormTaskHandlerApply(a,e)}},defaultFormTaskHandlerCancel:function(b,c){if(a(c.target).closest(".modal").length)cbrequire("cbj.bootstrap",function(){a(c.target).closest(".modal").modal("hide")});else{d.isViewInModal();var e=!1;try{e=window.parent!==window.self}catch(h){e=!0}1==e?window.parent.cbrequire(["cbj","cbj.colorbox"],function(a){a.colorbox.close()}):
d.isViewAjaxView()?d.loadSubview(d.getReturnUrl()):window.location.href=d.getReturnUrl()}},defaultFormTaskHandlerStore:function(b,c){cbrequire(["tinyMCE"],function(c){c.triggerSave();c=a(".kenedo-details-form");var h=new XMLHttpRequest;h.onload=d.getFormTaskResponseHandler(b);h.open("post",c[0].action,!0);h.send(new FormData(c[0]))})},defaultFormTaskHandlerApply:function(b,c){cbrequire(["tinyMCE"],function(c){c.triggerSave();c=a(".kenedo-details-form");var h=new XMLHttpRequest;h.onload=d.getFormTaskResponseHandler(b);
h.open("post",c[0].action,!0);h.send(new FormData(c[0]))})},defaultFormTaskResponseHandler:function(){var b=JSON.parse(this.responseText),c=d.getTask(),e=d.getViewName();b.wasInsert&&d.addNewJoinRecord(b);a(document).trigger("kenedoFormResponseReceived",{response:b,viewName:e,task:c});switch(c){case "store":d.defaultFormTaskResponseHandlerStore(e,b);break;case "storeAndNew":d.defaultFormTaskResponseHandlerStoreAndNew(e,b);break;case "apply":d.defaultFormTaskResponseHandlerApply(e,b)}},defaultFormTaskResponseHandlerStore:function(a,
c){!1===c.success?d.processResponseMessages(c):d.isViewInModal()?parent.window.cbrequire(["cbj","kenedo","cbj.colorbox"],function(a,b){b.reloadIntraListings();a.colorbox.close()}):d.isViewAjaxView()?d.loadSubview(d.getReturnUrl()):window.location.href=d.getReturnUrl()},defaultFormTaskResponseHandlerStoreAndNew:function(b,c){d.processResponseMessages(c);c.data&&a.each(c.data,function(b,c){a("#"+b).val(c)});a("#id").val("0");d.isViewInModal()?parent.window.cbrequire(["cbj","kenedo","cbj.colorbox"],
function(a,b){b.reloadIntraListings()}):d.isViewAjaxView()?d.loadSubview(d.getReturnUrl()):window.location.href=d.getReturnUrl()},defaultFormTaskResponseHandlerApply:function(b,c){d.processResponseMessages(c);!1!==c.success&&(c.data&&a.each(c.data,function(b,c){a("#"+b).val(c)}),d.isViewInModal()?parent.window.cbrequire(["kenedo"],function(a){a.reloadIntraListings()}):c.redirectUrl&&(d.isViewAjaxView()?d.loadSubview(c.redirectUrl):window.location.href=c.redirectUrl))},addNewJoinRecord:function(b){var c=
a("#form_custom_4").val();if(c){var e=b.data.id,d=b.data.name?b.data.name:"";d||(d=b.data.title?b.data.title:"");d||(d="New item");window.parent.cbrequire(["cbj"],function(a){var b=a("#"+c);b.is("select")&&0===b.find("option[value="+e+"]").length&&(b.append('<option value="'+e+'">'+d+"</option>"),b.val(e).change().trigger("chosen:updated"));a=b.closest(".property-body").find(".join-links");if(a.length){b=b.closest(".property-body").find(".join-link-0").clone();b.removeClass("join-link-0").addClass("join-link-"+
e);var f=b.find("a").attr("href"),f=f.replace("id=0","id="+e),f=f.replace("/id/0/","/id/"+e+"/");b.find("a").attr("href",f);b.css("display","inline-block");(f=a.find(".join-link:not(.join-link-0) a").eq(1).text())||(f="Open");b.find("a").text(f);a.append(b)}})}},getFormSettings:function(){var b=a(".kenedo-property :input").serializeArray(),c=[];a.each(b,function(){c[this.name]=this.value});return c},processResponseMessages:function(b){d.clearMessages();!1===b.success?a.each(b.errors,function(a,b){d.addMessage(b,
"error")}):a.each(b.messages,function(a,b){d.addMessage(b,"notice")});d.showMessages()},showMessages:function(){0!==this.messages.error.length&&(a(".kenedo-messages-error").html("<ul></ul>"),a.each(this.messages.error,function(b,c){a(".kenedo-messages-error ul").append("<li>"+c+"</li>")}),a(".kenedo-messages-error:first").show(),a(".kenedo-messages-error").addClass("flash"),window.setTimeout(function(){a(".kenedo-messages-error").removeClass("flash")},1E3));0!==this.messages.notice.length&&(a(".kenedo-messages-notice").html("<ul></ul>"),
a.each(this.messages.notice,function(b,c){a(".kenedo-messages-notice ul").append("<li>"+c+"</li>")}),a(".kenedo-messages-notice:first").show(),a(".kenedo-messages-notice").addClass("flash"),window.setTimeout(function(){a(".kenedo-messages-notice").removeClass("flash")},1E3));a(".kenedo-messages:first").show()},addMessage:function(a,c){"undefined"==typeof this.messages[c]&&(this.messages[c]=[]);this.messages[c].push(a)},clearMessages:function(){a(".kenedo-messages").hide();a(".kenedo-messages-error").html("").hide();
a(".kenedo-messages-notice").html("").hide();this.messages={error:[],notice:[]}}},f={openingDelay:200,closingDelay:200,openers:[],closers:[],clearOpeners:function(){a.each(f.openers,function(a,c){"undefined"!=typeof c&&window.clearTimeout(c.timeout)});f.openers=[]},clearClosers:function(){a.each(f.closers,function(a,c){"undefined"!=typeof c&&window.clearTimeout(c.timeout)});f.closers=[]},scheduleOpening:function(){var b=a(this).attr("id").replace("kenedo-popup-trigger-","");f.openers[b]&&window.clearTimeout(f.openers[b].timeout);
f.openers[b]={popupId:b,timeout:window.setTimeout(function(){f.open(b)},f.openingDelay)}},scheduleClosing:function(){var b;a(this).is(".kenedo-popup")&&(b=a(this).attr("id").replace("kenedo-popup-",""));a(this).is(".kenedo-popup-trigger")&&(b=a(this).attr("id").replace("kenedo-popup-trigger-",""));f.closers[b]&&window.clearTimeout(f.closers[b].timeout);f.closers[b]={popupId:b,timeout:window.setTimeout(function(){f.close(b)},f.closingDelay)}},cancelOpening:function(){var b;a(this).is(".kenedo-popup")&&
(b=a(this).attr("id").replace("kenedo-popup-",""));a(this).is(".kenedo-popup-trigger")&&(b=a(this).attr("id").replace("kenedo-popup-trigger-",""));f.openers[b]&&window.clearTimeout(f.openers[b].timeout)},cancelClosing:function(){var b;a(this).is(".kenedo-popup")&&(b=a(this).attr("id").replace("kenedo-popup-",""));a(this).is(".kenedo-popup-trigger")&&(b=a(this).attr("id").replace("kenedo-popup-trigger-",""));f.closers[b]&&window.clearTimeout(f.closers[b].timeout)},open:function(b){var c=a("#kenedo-popup-original-"+
b).clone(!0);a("#kenedo-popup-"+b).remove();c.hide();c.attr("id","kenedo-popup-"+b);c.appendTo("body");f.position(b);c.fadeIn();a("#kenedo-popup-trigger-"+b).trigger("popup-open")},close:function(b){a("#kenedo-popup-"+b).fadeOut(200,function(){a(this).remove()});a("#kenedo-popup-trigger-"+b).trigger("popup-close")},position:function(b){var c=a("#kenedo-popup-trigger-"+b);b=a("#kenedo-popup-"+b);b.css("visibility","hidden");b.css("display","block");a("body").append(b);var e=c.find(".kenedo-popup-trigger-content"),
c=e.outerWidth(),d=e.outerHeight(),k=e.offset(),g=b.find(".kenedo-popup-content").outerWidth(),f=b.find(".kenedo-popup-content").outerHeight(),q=Math.sqrt(1352)/2;b.outerWidth(g);b.outerHeight(f+q);var r=Math.max(document.documentElement.clientWidth,window.innerWidth||0),e=Math.max(document.documentElement.clientHeight,window.innerHeight||0),l=a("body").scrollTop(),m=a("body").scrollLeft(),n=k.left+c/2-g/2,c=k.top-f-q,d=k.top+d+q,f=d+f;0>n+m?(m=10+m,n-=m,k=document.createElement("style"),document.head.appendChild(k),
k.sheet.insertRule(".kenedo-popup-content:before {left:"+n+"px;}",k.sheet.cssRules.length),k.sheet.insertRule(".kenedo-popup-content:after {left:"+n+"px;}",k.sheet.cssRules.length),n=m):(m=document.createElement("style"),document.head.appendChild(m),m.sheet.insertRule(".kenedo-popup-content:before {left:auto;}",m.sheet.cssRules.length),m.sheet.insertRule(".kenedo-popup-content:after {left:auto;}",m.sheet.cssRules.length));g+n>r&&(m=r-g-10,n-=m,g=document.createElement("style"),document.head.appendChild(g),
g.sheet.insertRule(".kenedo-popup-content:before {left:"+n+"px;}",g.sheet.cssRules.length),g.sheet.insertRule(".kenedo-popup-content:after {left:"+n+"px;}",g.sheet.cssRules.length),n=m);g=c>l;e=f<e+l;l=null;b.hasClass("position-prefer-top")&&g&&(l=!0);b.hasClass("position-prefer-bottom")&&e&&(l=!1);null===l&&(l=g);l?(b.addClass("position-top").removeClass("position-bottom"),b.offset({left:n,top:c})):(b.addClass("position-bottom").removeClass("position-top"),b.offset({left:n,top:d}));b.css("display",
"none");b.css("visibility","visible");return b}},t={_keyStr:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",encode:function(a){var c="",e,d,f,g,p,q,r=0;for(a=t._utf8_encode(a);r<a.length;)e=a.charCodeAt(r++),d=a.charCodeAt(r++),f=a.charCodeAt(r++),g=e>>2,e=(e&3)<<4|d>>4,p=(d&15)<<2|f>>6,q=f&63,isNaN(d)?p=q=64:isNaN(f)&&(q=64),c=c+this._keyStr.charAt(g)+this._keyStr.charAt(e)+this._keyStr.charAt(p)+this._keyStr.charAt(q);return c},decode:function(a){var c="",e,d,f,g,p,q=0;for(a=
a.replace(/[^A-Za-z0-9\+\/=]/g,"");q<a.length;)e=this._keyStr.indexOf(a.charAt(q++)),d=this._keyStr.indexOf(a.charAt(q++)),g=this._keyStr.indexOf(a.charAt(q++)),p=this._keyStr.indexOf(a.charAt(q++)),e=e<<2|d>>4,d=(d&15)<<4|g>>2,f=(g&3)<<6|p,c+=String.fromCharCode(e),64!=g&&(c+=String.fromCharCode(d)),64!=p&&(c+=String.fromCharCode(f));return c=t._utf8_decode(c)},_utf8_encode:function(a){a=a.replace(/\r\n/g,"\n");for(var c="",e=0;e<a.length;e++){var d=a.charCodeAt(e);128>d?c+=String.fromCharCode(d):
(127<d&&2048>d?c+=String.fromCharCode(d>>6|192):(c+=String.fromCharCode(d>>12|224),c+=String.fromCharCode(d>>6&63|128)),c+=String.fromCharCode(d&63|128))}return c},_utf8_decode:function(a){for(var c="",d=0,f=0,k=0,g=0;d<a.length;)f=a.charCodeAt(d),128>f?(c+=String.fromCharCode(f),d++):191<f&&224>f?(k=a.charCodeAt(d+1),c+=String.fromCharCode((f&31)<<6|k&63),d+=2):(k=a.charCodeAt(d+1),g=a.charCodeAt(d+2),c+=String.fromCharCode((f&15)<<12|(k&63)<<6|g&63),d+=3);return c}};return d});
